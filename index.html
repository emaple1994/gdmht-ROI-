<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>ç›å“ˆç‰¹é›†å›¢ Â· çŸ«å¹³æœºæ™ºèƒ½é€‰å‹ä¸æ•ˆç›Šè¯„ä¼°å·¥å…·</title>
  <meta name="theme-color" content="#E60020" />
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    :root {
      --primary:#E60020;
      --primary-600:#C4001A;
      --bg:#F9FAFB;
      --text:#111827;
      --muted:#6B7280;
      --card:#FFFFFF;
      --green-bg:#DCFCE7;
      --green-text:#166534;
      --yellow-bg:#FEF3C7;
      --yellow-text:#92400E;
      --blue-bg:#DBEAFE;
      --blue-text:#1D4ED8;
      --red-bg:#FEE2E2;
      --red-text:#B91C1C;
      --purple:#6D28D9;
      --green:#16A34A;
      --border:#E5E7EB;
    }
    body {
      font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
      background:var(--bg);
      color:var(--text);
      font-size:16px;
      line-height:1.5;
      padding-bottom:env(safe-area-inset-bottom);
    }
    .container { max-width:600px; margin:0 auto; padding:16px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:16px; box-shadow:0 2px 8px rgba(0,0,0,0.04); }
    h2 { font-size:18px; font-weight:700; margin:0 0 16px; color:var(--text); }
    .form-item { margin-bottom:20px; }
    label { display:block; font-size:14px; font-weight:500; margin-bottom:8px; color:var(--text); }
    .btn-group { display:flex; flex-wrap:wrap; gap:8px; }
    .btn { min-height:48px; padding:12px 16px; border-radius:10px; border:1px solid var(--border); background:var(--card); font-size:16px; cursor:pointer; transition:all 0.2s; }
    .btn-primary { background:var(--primary); color:#fff; border-color:var(--primary); }
    .btn-primary:hover { background:var(--primary-600); }
    .btn-secondary { background:var(--card); color:var(--text); }
    .btn-secondary:hover { background:#F3F4F6; }
    input[type="number"], input[type="range"], select, input[type="text"], input[type="tel"], textarea { width:100%; font-size:16px; }
    input[type="number"], select, input[type="text"], input[type="tel"] { padding:12px; border:1px solid var(--border); border-radius:8px; min-height:48px; background:var(--card); }
    textarea { padding:12px; border:1px solid var(--border); border-radius:8px; background:var(--card); resize:vertical; font-family:inherit; }
    select[multiple] { min-height:120px; }
    .other-input { margin-top:8px; display:none; }
    .other-input.show { display:block; }
    .checkbox-list { display:grid; gap:8px; margin-top:8px; }
    .checkbox-item { display:flex; align-items:center; gap:8px; padding:8px; border:1px solid var(--border); border-radius:8px; cursor:pointer; transition:all 0.2s; }
    .checkbox-item:hover { background:#F9FAFB; }
    .checkbox-item input[type="checkbox"] { width:20px; height:20px; cursor:pointer; }
    .checkbox-item label { margin:0; cursor:pointer; flex:1; }
    .range-row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .range-ctr { display:grid; gap:6px; }
    .hint { font-size:12px; color:var(--muted); margin-top:4px; }
    .series-scroll { display:flex; gap:12px; overflow-x:auto; padding-bottom:8px; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; }
    .series-card { min-width:280px; scroll-snap-align:start; border:2px solid var(--border); }
    .series-card.recommended { border-color:#16A34A; }
    .series-card.selected { border-color:var(--primary); box-shadow:0 0 0 2px rgba(230,0,32,0.1); }
    .badge { display:inline-block; background:var(--blue-bg); color:var(--blue-text); font-size:12px; padding:4px 8px; border-radius:999px; font-weight:600; }
    .badge-special { display:inline-block; background:var(--green-bg); color:var(--green-text); font-size:12px; padding:4px 8px; border-radius:999px; font-weight:600; }
    .savings-grid { display:grid; gap:16px; }
    .savings-item { padding:12px; background:#F9FAFB; border-radius:8px; }
    .summary-card { background:var(--blue-bg); padding:16px; border-radius:8px; }
    .summary-card strong { display:block; margin-bottom:4px; }
    .advice { padding:14px 16px; border-radius:10px; margin-top:16px; }
    .fixed-actions { position:sticky; bottom:0; left:0; right:0; background:rgba(249,250,251,0.95); backdrop-filter:blur(8px); border-top:1px solid var(--border); padding:12px 16px; margin:0 -16px -16px; display:flex; gap:8px; flex-wrap:wrap; }
    .fixed-actions .btn { flex:1; min-width:120px; margin-bottom:0; }
    .fixed-actions .btn:last-child { margin-bottom:0; }
    @media (max-width:600px) { .fixed-actions { flex-direction:column; } .fixed-actions .btn { width:100%; } }
    .report-grid { grid-template-columns:1fr !important; }
    @media (min-width:768px) { .report-grid { grid-template-columns:1fr 1fr !important; } }
  </style>
</head>
<body>
  <div class="container">
    <header style="padding:16px 0; text-align:center; border-bottom:1px solid var(--border); margin-bottom:24px;">
      <h1 style="font-size:20px; font-weight:700; color:var(--primary);">ç›å“ˆç‰¹é›†å›¢</h1>
      <p style="font-size:14px; color:var(--muted); margin-top:4px;">çŸ«å¹³æœºæ™ºèƒ½é€‰å‹ä¸æ•ˆç›Šè¯„ä¼°å·¥å…·</p>
    </header>

    <!-- Step 1 -->
    <div class="card" id="step1">
      <h2>è¯·å¡«å†™æ‚¨çš„ææ–™ä¸ç”Ÿäº§æƒ…å†µ</h2>
      
      <div class="form-item">
        <label for="industry">æ‰€å±è¡Œä¸š</label>
        <select id="industry">
          <option value="èˆªç©ºèˆªå¤©">èˆªç©ºèˆªå¤©</option>
          <option value="å†›å·¥">å†›å·¥</option>
          <option value="é‡å‹æ¨¡å…·">é‡å‹æ¨¡å…·</option>
          <option value="å‹åŠ›å®¹å™¨">å‹åŠ›å®¹å™¨</option>
          <option value="æ ¸ç”µ">æ ¸ç”µ</option>
          <option value="ç²¾å¯†ç”µå­">ç²¾å¯†ç”µå­</option>
          <option value="åŒ»ç–—å™¨æ¢°">åŒ»ç–—å™¨æ¢°</option>
          <option value="æ–°èƒ½æºç”µæ± ">æ–°èƒ½æºç”µæ± </option>
          <option value="ç”µæ¢¯">ç”µæ¢¯</option>
          <option value="é£Ÿå“æœºæ¢°">é£Ÿå“æœºæ¢°</option>
          <option value="æœºç®±æœºæŸœ">æœºç®±æœºæŸœ</option>
          <option value="æ¿€å…‰åˆ‡å‰²">æ¿€å…‰åˆ‡å‰²</option>
          <option value="é€šç”¨é’£é‡‘">é€šç”¨é’£é‡‘</option>
          <option value="è‡ªåŠ¨åŒ–è®¾å¤‡">è‡ªåŠ¨åŒ–è®¾å¤‡</option>
          <option value="å»ºç­‘é’¢æ„">å»ºç­‘é’¢æ„</option>
          <option value="ä»“å‚¨è´§æ¶">ä»“å‚¨è´§æ¶</option>
          <option value="å†œæœº">å†œæœº</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
      </div>

      <div class="form-item">
        <label for="material">ä¸»è¦åŠ å·¥ææ–™</label>
        <select id="material">
          <option value="å†·è½§é’¢">å†·è½§é’¢</option>
          <option value="çƒ­è½§é’¢">çƒ­è½§é’¢</option>
          <option value="ä¸é”ˆé’¢">ä¸é”ˆé’¢</option>
          <option value="é•€é”Œæ¿">é•€é”Œæ¿</option>
          <option value="é“æ¿">é“æ¿</option>
          <option value="é“œ">é“œ</option>
          <option value="é»„é“œ">é»„é“œ</option>
          <option value="é’›åˆé‡‘">é’›åˆé‡‘</option>
          <option value="é•åˆé‡‘">é•åˆé‡‘</option>
          <option value="å…¶ä»–æè´¨">å…¶ä»–æè´¨</option>
        </select>
        <div class="other-input" id="otherMaterialInput">
          <input type="text" id="otherMaterialText" placeholder="è¯·å¡«å†™å…¶ä»–æè´¨" />
        </div>
      </div>

      <div class="form-item">
        <label for="thicknessMax">æœ€å¤§åšåº¦ï¼ˆmmï¼‰</label>
        <input type="number" id="thicknessMax" min="0" max="100" step="0.01" value="3.0" />
        <div class="hint">èŒƒå›´ï¼š0-100mm</div>
      </div>

      <div class="form-item">
        <label for="maxWidth">æœ€å¤§æ¿å®½ï¼ˆmmï¼‰</label>
        <input type="number" id="maxWidth" min="100" max="2100" value="1500" />
        <div class="hint">èŒƒå›´ï¼š100â€“2100ï¼Œé»˜è®¤1500</div>
      </div>

      <div class="form-item">
        <label for="annualTons">å¹´åŠ å·¥é‡ï¼ˆå¨/å¹´ï¼‰</label>
        <input type="number" id="annualTons" min="0" value="10000" />
        <div class="hint">è¯·è¾“å…¥å¹´åŠ å·¥é‡ï¼ˆå¨ï¼‰</div>
      </div>

      <div class="form-item">
        <label>å½“å‰ä¸»è¦ç—›ç‚¹ï¼ˆæœ€å¤š5é¡¹ï¼‰</label>
        <div class="checkbox-list" id="painsGroup">
          <div class="checkbox-item">
            <input type="checkbox" id="pain1" value="è¡¨é¢æœ‰å‹ç—•æˆ–è¾Šå°" />
            <label for="pain1">è¡¨é¢æœ‰å‹ç—•æˆ–è¾Šå°</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="pain2" value="è¾¹ç¼˜æ³¢æµªå˜å½¢" />
            <label for="pain2">è¾¹ç¼˜æ³¢æµªå˜å½¢</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="pain3" value="å†²å‹æ—¶å¼€è£‚æˆ–å›å¼¹" />
            <label for="pain3">å†²å‹æ—¶å¼€è£‚æˆ–å›å¼¹</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="pain4" value="ç„Šæ¥åä¸¥é‡å˜å½¢" />
            <label for="pain4">ç„Šæ¥åä¸¥é‡å˜å½¢</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="pain5" value="æ¯å¤©éœ€è¿”å·¥ >1 å°æ—¶" />
            <label for="pain5">æ¯å¤©éœ€è¿”å·¥ >1 å°æ—¶</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="pain6" value="å®¢æˆ·å› å¹³æ•´åº¦é—®é¢˜é€€è´§" />
            <label for="pain6">å®¢æˆ·å› å¹³æ•´åº¦é—®é¢˜é€€è´§</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="pain7" value="å…¶ä»–" />
            <label for="pain7">å…¶ä»–</label>
          </div>
        </div>
        <div class="hint">æœ€å¤šé€‰æ‹©5é¡¹</div>
        <div class="other-input" id="otherPainInput">
          <input type="text" id="otherPainText" placeholder="è¯·å¡«å†™å…¶ä»–ç—›ç‚¹" />
        </div>
      </div>

      <div class="form-item" style="margin-top:24px;">
        <button class="btn btn-primary" id="recommendBtn" style="width:100%;">æ™ºèƒ½æ¨è</button>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="card" id="step2" style="display:none;">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
        <h2 style="margin:0;">ä¸ºæ‚¨åŒ¹é…çš„ç›å“ˆç‰¹çŸ«å¹³æœºç³»åˆ—</h2>
        <button class="btn btn-secondary" id="backToStep1Btn" style="padding:8px 16px; font-size:14px;">â† è¿”å›ä¸Šä¸€é¡µ</button>
      </div>
      <div class="hint" style="margin-bottom:12px;">è¯·é€‰æ‹©æ‚¨æ„Ÿå…´è¶£çš„ç³»åˆ—è¿›è¡ŒROIè¯„ä¼°ï¼ˆç³»ç»Ÿå·²ä¸ºæ‚¨æ¨èæœ€é€‚åˆçš„ç³»åˆ—ï¼‰</div>
      <div class="series-scroll" id="seriesContainer"></div>
      <div class="hint" style="margin-top:12px;">ç›å“ˆç‰¹è®¾å¤‡ä¸ºéæ ‡å®šåˆ¶ï¼Œå‚è€ƒä»·åŸºäºå…¸å‹é…ç½®ä¼°ç®—ï¼Œæœ€ç»ˆæŠ¥ä»·éœ€å·¥ç¨‹å¸ˆç°åœºè¯„ä¼°åæä¾›ã€‚</div>
      <div class="form-item" style="margin-top:20px;">
        <button class="btn btn-primary" id="evaluateROIBtn" style="width:100%;">ç«‹å³è¯„ä¼°æ‚¨çš„ROI</button>
      </div>

      <!-- ROIæµ‹ç®—è¾“å…¥ï¼ˆç‚¹å‡»æŒ‰é’®åæ˜¾ç¤ºï¼‰ -->
      <div id="roiInputSection" style="display:none; margin-top:24px; padding-top:24px; border-top:2px solid var(--border);">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
        <h2 style="margin:0;">é¢„è®¡æ¯å¹´ä¸ºæ‚¨èŠ‚çœå¤šå°‘ï¼Ÿ</h2>
        <button class="btn btn-secondary" id="backToStep2Btn" style="padding:8px 16px; font-size:14px;">â† è¿”å›ä¸Šä¸€é¡µ</button>
      </div>
      <div class="hint" style="background:var(--blue-bg); padding:12px; border-radius:8px; margin-bottom:16px;">
        ä»¥ä¸‹ä¼°ç®—åŸºäºæ‚¨å‹¾é€‰çš„ç—›ç‚¹å’Œç›å“ˆç‰¹ 2024 å¹´ 300+ å®¢æˆ·å®æµ‹æ•°æ®ã€‚<strong>ä»…æ˜¾ç¤ºä¸æ‚¨ç›¸å…³çš„èŠ‚çœé¡¹</strong>ï¼Œæ‚¨å¯è°ƒæ•´æ•°å€¼ä»¥åŒ¹é…å®é™…æƒ…å†µã€‚
      </div>
      
      <div class="savings-grid">
        <!-- 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Šï¼ˆæ‰€æœ‰ç”¨æˆ·æ˜¾ç¤ºï¼‰ -->
        <div class="savings-item" id="savings-item-1">
          <label><strong>1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Š</strong></label>
          <div style="background:#F0F9FF; padding:12px; border-radius:8px; margin:8px 0; border-left:3px solid var(--blue-text);">
            <div style="font-size:13px; color:var(--blue-text); margin-bottom:4px;"><strong>ğŸ’¬ ä¸ºä»€ä¹ˆèƒ½çœï¼Ÿ</strong></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.6;">
              "åŸæ‰‹å·¥/æ—§è®¾å¤‡æ¯æœˆåŠ å·¥é‡ â†’ æ–°çŸ«å¹³æœºæ¯å°æ—¶å¤„ç†é‡æå‡"<br>
              <strong>å¹´å¢æ”¶ç›Š = å¹´å·¥ä½œæ—¥ Ã— æ¯æ—¥å·¥ä½œå°æ—¶ Ã—ï¼ˆæ–°è®¾å¤‡äº§èƒ½ - åŸè®¾å¤‡äº§èƒ½ï¼‰Ã— å•ä½äº§å“åˆ©æ¶¦</strong>
            </div>
          </div>
          <div style="margin:12px 0;">
            <label style="font-size:13px; display:block; margin-bottom:4px;">åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡ï¼ˆå¨ï¼‰ï¼š</label>
            <input type="number" id="s1_oldCapacity" value="833" placeholder="åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡(å¨)" step="0.01" style="margin-bottom:8px;" />
            <!-- éšè—å­—æ®µï¼šæ–°çŸ«å¹³æœºæ¯å°æ—¶å¤„ç†é‡ï¼ˆå¨ï¼‰ï¼Œåå°è®¡ç®— -->
            <input type="hidden" id="s1_newCapacity" value="3" />
            
            <label style="font-size:13px; display:block; margin-bottom:4px;">å¹´å·¥ä½œæ—¥ï¼š</label>
            <div style="padding:12px; background:#F3F4F6; border-radius:8px; margin-bottom:8px; color:var(--muted);">
              é€šå¸¸ä¸º 250â€“300 å¤©
            </div>
            <input type="hidden" id="s1_workDays" value="275" />
            <input type="hidden" id="s1_workHours" value="2200" />
            
            <label style="font-size:13px; display:block; margin-bottom:4px;">å•ä½äº§å“åˆ©æ¶¦ï¼ˆå…ƒ/å¨ï¼‰ï¼š</label>
            <input type="number" id="s1_profitPerTon" value="100" placeholder="å•ä½äº§å“åˆ©æ¶¦(Â¥/å¨)" />
            <div class="hint" style="margin-top:4px; font-size:12px;">ğŸ’¡ é»˜è®¤å€¼å·²æ ¹æ®æ‚¨çš„å¹´åŠ å·¥é‡æ™ºèƒ½ä¼°ç®—ï¼Œæ‚¨å¯ä¿®æ”¹ä¸ºå®é™…å€¼</div>
          </div>
        </div>

        <!-- 2. ææ–™åˆ©ç”¨ç‡æå‡ï¼ˆå‡å°‘åºŸå“/è¿”å·¥ï¼‰ï¼ˆæ‰€æœ‰ç”¨æˆ·æ˜¾ç¤ºï¼‰ -->
        <div class="savings-item" id="savings-item-2">
          <label><strong>2. ææ–™åˆ©ç”¨ç‡æå‡ï¼ˆå‡å°‘åºŸå“/è¿”å·¥ï¼‰</strong></label>
          <div style="background:#F0F9FF; padding:12px; border-radius:8px; margin:8px 0; border-left:3px solid var(--blue-text);">
            <div style="font-size:13px; color:var(--blue-text); margin-bottom:4px;"><strong>ğŸ’¬ ä¸ºä»€ä¹ˆèƒ½çœï¼Ÿ</strong></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.6;">
              "çŸ«å¹³ç²¾åº¦æé«˜ â†’ æ¿æ/å¸¦æåˆæ ¼ç‡ä» A% æå‡è‡³ B%ï¼ˆB% é€šå¸¸ä¸º 96%~99%ï¼‰"<br>
              <strong>å¹´èŠ‚çº¦æˆæœ¬ = å¹´ææ–™æˆæœ¬ Ã—ï¼ˆB% â€“ A%ï¼‰</strong>
            </div>
          </div>
          <div style="margin:12px 0;">
            <label style="font-size:13px; display:block; margin-bottom:4px;">åŸåˆæ ¼ç‡ï¼ˆ%ï¼‰ï¼š</label>
            <input type="number" id="s2_oldRate" value="85" placeholder="åŸåˆæ ¼ç‡(%)" min="0" max="100" style="margin-bottom:8px;" />
            <!-- éšè—å­—æ®µï¼šæ–°åˆæ ¼ç‡ï¼ˆ%ï¼‰ï¼Œé»˜è®¤96%~99%ï¼Œåå°è®¡ç®— -->
            <input type="hidden" id="s2_newRate" value="97" />
            <label style="font-size:13px; display:block; margin-bottom:4px;">å¹´ææ–™æˆæœ¬ï¼ˆå…ƒï¼‰ï¼š</label>
            <input type="number" id="s2_materialCost" value="5000000" placeholder="å¹´ææ–™æˆæœ¬(Â¥)" />
            <div class="hint" style="margin-top:4px; font-size:12px;">ğŸ’¡ å¹´ææ–™æˆæœ¬å·²æ ¹æ®æ‚¨çš„ææ–™ç±»å‹å’Œå¹´åŠ å·¥é‡æ™ºèƒ½è®¡ç®—ï¼Œæ‚¨å¯ä¿®æ”¹</div>
          </div>
        </div>

        <!-- 3. äººå·¥æˆæœ¬èŠ‚çº¦ï¼ˆæ‰€æœ‰ç”¨æˆ·æ˜¾ç¤ºï¼‰ -->
        <div class="savings-item" id="savings-item-3">
          <label><strong>3. äººå·¥æˆæœ¬èŠ‚çº¦</strong></label>
          <div style="background:#F0F9FF; padding:12px; border-radius:8px; margin:8px 0; border-left:3px solid var(--blue-text);">
            <div style="font-size:13px; color:var(--blue-text); margin-bottom:4px;"><strong>ğŸ’¬ ä¸ºä»€ä¹ˆèƒ½çœï¼Ÿ</strong></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.6;">
              "åŸéœ€ N äººæ“ä½œ â†’ æ–°è®¾å¤‡åªéœ€ 1 äºº"<br>
              <strong>å¹´èŠ‚çœäººå·¥æ”¯å‡º = ï¼ˆN â€“ 1ï¼‰Ã— é¢„ä¼°äººå‡å¹´æˆæœ¬</strong>
            </div>
          </div>
          <div style="margin:12px 0;">
            <label style="font-size:13px; display:block; margin-bottom:4px;">åŸæ“ä½œäººæ•°ï¼š</label>
            <input type="number" id="s3_oldWorkers" value="3" placeholder="åŸæ“ä½œäººæ•°" min="1" style="margin-bottom:8px;" />
            <label style="font-size:13px; display:block; margin-bottom:4px;">æ–°è®¾å¤‡æ“ä½œäººæ•°ï¼š</label>
            <div style="padding:12px; background:#F3F4F6; border-radius:8px; margin-bottom:8px; color:var(--muted);">
              1 äººï¼ˆç³»ç»Ÿé»˜è®¤ï¼‰
            </div>
            <input type="hidden" id="s3_newWorkers" value="1" />
            <label style="font-size:13px; display:block; margin-bottom:4px;">é¢„ä¼°äººå‡å¹´æˆæœ¬ï¼ˆå…ƒï¼‰ï¼š</label>
            <input type="number" id="s3_costPerWorker" value="60000" placeholder="é¢„ä¼°äººå‡å¹´æˆæœ¬(Â¥)" />
            <div class="hint" style="margin-top:4px; font-size:12px;">ğŸ’¡ é¢„ä¼°äººå‡å¹´æˆæœ¬åŒ…å«å·¥èµ„ã€ç¤¾ä¿ã€ç®¡ç†è´¹ç­‰ç»¼åˆæˆæœ¬</div>
          </div>
        </div>

        <!-- 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½ï¼ˆæ‰€æœ‰ç³»åˆ—éƒ½æ˜¾ç¤ºï¼‰ -->
        <div class="savings-item" id="savings-item-4">
          <label><strong>4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½</strong></label>
          <div style="background:#F0F9FF; padding:12px; border-radius:8px; margin:8px 0; border-left:3px solid var(--blue-text);">
            <div style="font-size:13px; color:var(--blue-text); margin-bottom:4px;"><strong>ğŸ’¬ ä¸ºä»€ä¹ˆèƒ½çœï¼Ÿ</strong></div>
            <div style="font-size:12px; color:var(--muted); line-height:1.6;">
              "æ–°è®¾å¤‡æ¯”æ—§è®¾å¤‡èŠ‚èƒ½ â†’ å¹´ç”µè´¹èŠ‚çº¦"<br>
              <strong>å¹´ç”µè´¹èŠ‚çº¦ = å¹´ç”µè´¹ Ã— èŠ‚èƒ½æ¯”ä¾‹</strong>
            </div>
          </div>
          <div style="margin:12px 0;">
            <label style="font-size:13px; display:block; margin-bottom:4px;">å¹´ç”µè´¹ï¼ˆå…ƒï¼‰ï¼š</label>
            <input type="number" id="s4_energyCost" value="100000" placeholder="å¹´ç”µè´¹(Â¥)" style="margin-bottom:8px;" />
            <label style="font-size:13px; display:block; margin-bottom:4px;">èŠ‚èƒ½æ¯”ä¾‹ï¼ˆ%ï¼‰ï¼š</label>
            <div style="padding:12px; background:#F3F4F6; border-radius:8px; margin-bottom:8px; color:var(--muted);" id="s4_energySaveRateDisplay">
              æ ¹æ®è®¾å¤‡ç³»åˆ—è‡ªåŠ¨è®¡ç®—
            </div>
            <input type="hidden" id="s4_energySaveRate" value="50" />
            <div class="hint" style="margin-top:4px; font-size:12px;">ğŸ’¡ ç³»ç»Ÿå·²æ ¹æ®æ‚¨é€‰æ‹©çš„è®¾å¤‡ç³»åˆ—è‡ªåŠ¨è®¡ç®—èŠ‚èƒ½æ¯”ä¾‹</div>
          </div>
        </div>
      </div>

      <div class="form-item" style="margin-top:24px;">
        <button class="btn btn-primary" id="calculateReportBtn" style="width:100%;">è®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘Š</button>
      </div>
      </div>
      <!-- ROIæµ‹ç®—è¾“å…¥ç»“æŸ -->
    </div>

    <!-- Step 4: ç»“æœæŠ¥å‘Šé¡µé¢ -->
    <div class="card" id="step4" style="display:none;">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
        <h2 style="margin:0;">ROIæµ‹ç®—æŠ¥å‘Š</h2>
        <button class="btn btn-secondary" id="backToROIInputBtn" style="padding:8px 16px; font-size:14px;">â† è¿”å›ä¸Šä¸€é¡µ</button>
      </div>
      
      <!-- ç”Ÿäº§æƒ…å†µæ¦‚è§ˆå¡ç‰‡ -->
      <div class="card" style="padding:16px; margin-bottom:16px; background:var(--blue-bg);">
        <h3 style="font-size:14px; margin:0 0 12px; color:var(--blue-text); font-weight:600;">ç”Ÿäº§æƒ…å†µæ¦‚è§ˆ</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:13px;">
          <div><span class="hint">æ‰€å±è¡Œä¸šï¼š</span><strong id="reportIndustry">é€šç”¨é’£é‡‘</strong></div>
          <div><span class="hint">ä¸»è¦ææ–™ï¼š</span><strong id="reportMaterial">å†·è½§é’¢</strong></div>
          <div><span class="hint">æœ€å¤§åšåº¦ï¼š</span><strong id="reportThickness">3.0 mm</strong></div>
          <div><span class="hint">æœ€å¤§æ¿å®½ï¼š</span><strong id="reportWidth">1500 mm</strong></div>
          <div style="grid-column:1/-1;"><span class="hint">å¹´åŠ å·¥é‡ï¼š</span><strong id="reportTons">10000 å¨</strong></div>
        </div>
        <div style="margin-top:8px; font-size:12px; color:var(--muted);" id="reportPains"></div>
      </div>

      <!-- è®¾å¤‡ä¿¡æ¯å¡ç‰‡ -->
      <div class="card" style="padding:16px; margin-bottom:16px; background:linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
          <strong style="font-size:16px;" id="reportSeriesName">æ…§ Mastery è±ªåå‹</strong>
          <span class="badge-special">å·²é€‰æ‹©</span>
        </div>
        <div class="hint" style="margin-bottom:4px;">è®¾å¤‡å‚è€ƒä»·ï¼š<span id="reportPrice" style="color:var(--primary); font-weight:600;">Â¥650,000</span></div>
        <div class="hint">èƒ½åŠ›ï¼š<span id="reportCap">æœ€å¤§åšåº¦ 40mmï½œæœ€å¤§å®½åº¦ â‰¤2100mm</span></div>
      </div>

      <!-- æŠ•å…¥æ˜ç»†å¡ç‰‡ -->
      <div class="card" style="padding:16px; margin-bottom:16px; background:var(--yellow-bg);">
        <h3 style="font-size:14px; margin:0 0 12px; color:var(--yellow-text); font-weight:600;">ğŸ’° æ€»æŠ•å…¥ï¼ˆTCOï¼‰</h3>
        <div style="display:grid; gap:8px; font-size:13px; margin-bottom:12px;">
          <div style="display:flex; justify-content:space-between;">
            <span class="hint">è®¾å¤‡æœ¬ä½“ä»·æ ¼ï¼š</span>
            <strong id="reportInvestmentDevice">Â¥650,000</strong>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span class="hint">è¿è¾“ã€å®‰è£…ã€è°ƒè¯•ï¼š</span>
            <strong id="reportInvestmentInstall">Â¥32,500</strong>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span class="hint">è¾…åŠ©é…å¥—æŠ•å…¥ï¼š</span>
            <strong id="reportInvestmentAux">Â¥19,500</strong>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span class="hint">åŸ¹è®­ä¸äººåŠ›æˆæœ¬ï¼š</span>
            <strong id="reportInvestmentTraining">Â¥13,000</strong>
          </div>
          <div style="display:flex; justify-content:space-between;">
            <span class="hint">é¦–å¹´ç»´æŠ¤ä¸å¤‡ä»¶ï¼š</span>
            <strong id="reportInvestmentMaintenance">Â¥26,000</strong>
          </div>
        </div>
        <div style="border-top:2px solid var(--yellow-text); padding-top:8px; margin-top:8px;">
          <div style="display:flex; justify-content:space-between; font-size:16px; font-weight:700; color:var(--yellow-text);">
            <span>æ€»æŠ•å…¥ï¼š</span>
            <span id="reportTotalInvestment">Â¥741,000</span>
          </div>
        </div>
      </div>

      <!-- æ€»æ”¶ç›Šæ¿å— -->
      <div class="card" style="padding:16px; margin-bottom:16px; background:var(--green-bg);">
        <h3 style="font-size:14px; margin:0 0 12px; color:var(--green-text); font-weight:600;">ğŸ’° æ€»æ”¶ç›Šï¼ˆå¹´å‡€æ”¶ç›Šï¼‰</h3>
        <div style="display:flex; align-items:center; justify-content:space-between; padding:12px; background:#fff; border-radius:8px; border:2px solid var(--green); margin-bottom:12px;">
          <span style="font-size:16px; font-weight:600; color:var(--text);">å¹´åº¦æ€»æ”¶ç›Šï¼š</span>
          <span style="font-size:28px; font-weight:700; color:var(--green);" id="reportTotalReturns">Â¥202,800</span>
        </div>
        
        <!-- å…³é”®æŒ‡æ ‡ç™¾åˆ†æ¯” -->
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:12px;">
          <div style="padding:10px; background:#fff; border-radius:6px; text-align:center;">
            <div class="hint" style="font-size:11px; margin-bottom:4px; color:var(--muted);">è‰¯å“ç‡æå‡</div>
            <div style="font-size:18px; font-weight:700; color:var(--green);" id="reportQualityRate">+10%</div>
          </div>
          <div style="padding:10px; background:#fff; border-radius:6px; text-align:center;">
            <div class="hint" style="font-size:11px; margin-bottom:4px; color:var(--muted);">äººå·¥èŠ‚çœ</div>
            <div style="font-size:18px; font-weight:700; color:var(--green);" id="reportLaborSave">-66.7%</div>
          </div>
          <div style="padding:10px; background:#fff; border-radius:6px; text-align:center;">
            <div class="hint" style="font-size:11px; margin-bottom:4px; color:var(--muted);">æ•ˆç‡æå‡</div>
            <div style="font-size:18px; font-weight:700; color:var(--green);" id="reportEfficiency">+50%</div>
          </div>
          <div style="padding:10px; background:#fff; border-radius:6px; text-align:center;">
            <div class="hint" style="font-size:11px; margin-bottom:4px; color:var(--muted);">èƒ½è€—é™ä½</div>
            <div style="font-size:18px; font-weight:700; color:var(--green);" id="reportEnergySave">-50%</div>
          </div>
        </div>
        
        <div class="hint" style="margin-top:12px; font-size:12px; color:var(--muted);">
          åŒ…å«ï¼šæ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Š + ææ–™åˆ©ç”¨ç‡æå‡ + äººå·¥æˆæœ¬èŠ‚çº¦ + èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½
        </div>
      </div>

      <!-- æ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡ -->
      <div class="card" style="padding:20px; margin-bottom:16px; background:var(--blue-bg);">
        <h3 style="font-size:16px; margin:0 0 16px; color:var(--blue-text);">æ ¸å¿ƒæŒ‡æ ‡</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <div>
            <div class="hint" style="margin-bottom:4px;">å¹´å‡€æ”¶ç›Š</div>
            <div style="font-size:24px; font-weight:700; color:var(--green);" id="reportTotalSaving">Â¥202,800</div>
          </div>
          <div>
            <div class="hint" style="margin-bottom:4px;">æŠ•èµ„å›æŠ¥å‘¨æœŸ</div>
            <div style="font-size:24px; font-weight:700; color:var(--text);" id="reportPayback">3å¹´2ä¸ªæœˆ</div>
          </div>
          <div style="grid-column:1/-1;">
            <div class="hint" style="margin-bottom:4px;">å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡ (ROI)</div>
            <div style="font-size:32px; font-weight:700; color:var(--purple);" id="reportROI">27.4%</div>
          </div>
        </div>
        <div class="hint" style="margin-top:12px; font-size:12px; line-height:1.6;">
          ğŸ’¡ <strong>é•¿æœŸä»·å€¼</strong>ï¼šçŸ«å¹³æœºå¯¿å‘½é€šå¸¸10å¹´ä»¥ä¸Šï¼Œå³ä½¿å›æ”¶æœŸ2-3å¹´ï¼Œåç»­å‡ä¸ºçº¯æ”¶ç›Šã€‚æŒ‰10å¹´è®¡ç®—ï¼Œç´¯è®¡æ”¶ç›Šå¯è¾¾æŠ•èµ„é¢çš„æ•°å€ã€‚
        </div>
      </div>

      <!-- ç»“è®ºå»ºè®®å¡ç‰‡ -->
      <div class="card" id="reportConclusion" style="padding:16px; margin-bottom:16px;">
        <h3 style="font-size:16px; margin:0 0 12px;">ç»“è®ºå»ºè®®</h3>
        <div class="advice" id="reportAdvice" style="background:var(--green-bg); color:var(--green-text); margin:0;">
          å¼ºçƒˆæ¨èï¼šå¿«é€Ÿå›æœ¬ï¼Œå½»åº•è§£å†³ç„Šæ¥å˜å½¢ä¸è¡¨é¢è´¨é‡é—®é¢˜ï¼
        </div>
      </div>
    </div>

    <!-- ç•™èµ„è¡¨å•é¡µé¢ -->
    <div class="card" id="leadForm" style="display:none;">
      <h2>è·å–ç²¾å‡†æ–¹æ¡ˆ</h2>
      <div class="hint" style="margin-bottom:16px;">è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼Œæˆ‘ä»¬çš„å·¥ç¨‹å¸ˆå°†ä¸ºæ‚¨æä¾›å®šåˆ¶åŒ–æ–¹æ¡ˆ</div>
      
      <div class="form-item">
        <label for="leadName">å§“å *</label>
        <input type="text" id="leadName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required />
      </div>
      
      <div class="form-item">
        <label for="leadPhone">ç”µè¯ *</label>
        <input type="tel" id="leadPhone" placeholder="è¯·è¾“å…¥æ‚¨çš„è”ç³»ç”µè¯" required />
      </div>
      
      <div class="form-item">
        <label for="leadIndustry">æ‰€å±è¡Œä¸š</label>
        <input type="text" id="leadIndustry" readonly style="background:#F3F4F6;" />
      </div>
      
      <div class="form-item">
        <label for="leadRemark">å¤‡æ³¨</label>
        <textarea id="leadRemark" rows="4" placeholder="è¯·æè¿°æ‚¨çš„å…·ä½“éœ€æ±‚æˆ–é—®é¢˜ï¼ˆé€‰å¡«ï¼‰"></textarea>
      </div>
      
      <div class="form-item" style="margin-top:24px;">
        <button class="btn btn-secondary" id="viewDataBtn" style="width:100%; margin-bottom:12px;">ğŸ“Š æŸ¥çœ‹è¾“å…¥æ•°æ®</button>
        <button class="btn btn-primary" id="submitLeadBtn" style="width:100%;">æäº¤</button>
      </div>
      
      <div class="form-item" style="margin-top:12px;">
        <button class="btn btn-secondary" id="cancelLeadBtn" style="width:100%;">å–æ¶ˆ</button>
      </div>
    </div>
    
    <!-- æ•°æ®é¢„è§ˆå¼¹çª— -->
    <div id="dataPreviewModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:9999; padding:10px; overflow-y:auto;">
      <div style="background:white; max-width:600px; margin:20px auto; padding:16px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.2);">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:16px;">
          <h2 style="margin:0; font-size:18px;">ğŸ“Š å®Œæ•´è¾“å…¥æ•°æ®é¢„è§ˆ</h2>
          <button id="closeDataPreviewBtn" style="background:none; border:none; font-size:28px; cursor:pointer; color:#666; width:32px; height:32px; display:flex; align-items:center; justify-content:center; padding:0;">Ã—</button>
        </div>
        <div id="dataPreviewContent" style="max-height:calc(100vh - 200px); overflow-y:auto; font-size:14px; line-height:1.8;">
          <!-- æ•°æ®å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€å¡«å…… -->
        </div>
        <div style="margin-top:16px; padding-top:16px; border-top:1px solid #eee;">
          <button class="btn btn-secondary" id="copyDataBtn" style="width:100%; margin-bottom:12px;">ğŸ“‹ å¤åˆ¶æ•°æ®</button>
          <button class="btn btn-primary" id="closeDataPreviewBtn2" style="width:100%;">å…³é—­</button>
        </div>
      </div>
    </div>
    
    <!-- è”ç³»ä¿¡æ¯å¼¹çª— -->
    <div id="contactInfoModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:9999; padding:10px; overflow-y:auto;">
      <div style="background:white; max-width:500px; margin:20px auto; padding:24px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.2);">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:24px;">
          <h2 style="margin:0; font-size:20px; color:#E60020;">ğŸ“ è”ç³»æˆ‘ä»¬</h2>
          <button id="closeContactInfoBtn" style="background:none; border:none; font-size:28px; cursor:pointer; color:#666; width:32px; height:32px; display:flex; align-items:center; justify-content:center; padding:0;">Ã—</button>
        </div>
        
        <div style="margin-bottom:24px;">
          <div style="padding:16px; background:#F9FAFB; border-radius:8px; margin-bottom:12px;">
            <div style="display:flex; align-items:center; margin-bottom:8px;">
              <span style="font-size:20px; margin-right:10px;">ğŸ“</span>
              <a href="tel:4000898858" style="color:#E60020; text-decoration:none; font-size:18px; font-weight:600;">400-0898-858</a>
            </div>
          </div>
          
          <div style="padding:16px; background:#F9FAFB; border-radius:8px; margin-bottom:12px;">
            <div style="display:flex; align-items:center; margin-bottom:8px;">
              <span style="font-size:20px; margin-right:10px;">âœ‰ï¸</span>
              <a href="mailto:mht@gdmht.com" style="color:#333; text-decoration:none; font-size:16px;">mht@gdmht.com</a>
            </div>
          </div>
          
          <div style="padding:16px; background:#F9FAFB; border-radius:8px; margin-bottom:12px;">
            <div style="display:flex; align-items:center; margin-bottom:8px;">
              <span style="font-size:20px; margin-right:10px;">ğŸ“±</span>
              <a href="tel:076986301265" style="color:#333; text-decoration:none; font-size:16px;">0769-86301265</a>
            </div>
          </div>
          
          <div style="padding:16px; background:#F9FAFB; border-radius:8px; margin-bottom:12px;">
            <div style="display:flex; align-items:center; margin-bottom:8px;">
              <span style="font-size:20px; margin-right:10px;">ğŸŒ</span>
              <a href="https://www.mahatma.com.cn" target="_blank" rel="noopener noreferrer" style="color:#333; text-decoration:none; font-size:16px;">www.mahatma.com.cn</a>
            </div>
          </div>
        </div>
        
        <div style="padding:16px; background:#E0F2FE; border-radius:8px; border-left:4px solid #1E3A8A; margin-bottom:20px;">
          <div style="font-weight:600; color:#1E3A8A; margin-bottom:12px; font-size:16px;">å…¬å¸åœ°å€ Company Address</div>
          <div style="font-weight:600; color:#333; margin-bottom:8px; font-size:15px;">å¹¿ä¸œæ€»éƒ¨ Guangdong Headquarters</div>
          <div style="color:#666; font-size:14px; line-height:1.8;">
            å¹¿ä¸œçœä¸œèå¸‚çŸ³ç¢£é•‡è¥¿å—å˜‰åº”ä¸€è¡—3å·ç›å“ˆç‰¹å·¥ä¸šå›­
          </div>
        </div>
        
        <div style="margin-top:20px; padding-top:20px; border-top:1px solid #eee;">
          <button class="btn btn-primary" id="closeContactInfoBtn2" style="width:100%;">å…³é—­</button>
        </div>
      </div>
    </div>

    <div class="fixed-actions">
      <button class="btn btn-primary" id="getSolutionBtn">ğŸ“˜ è·å–ç²¾å‡†æ–¹æ¡ˆ</button>
      <button class="btn btn-secondary" id="freeTestBtn">ğŸ“¤ å…è´¹å¯„æ ·çŸ«å¹³æµ‹è¯•</button>
      <a href="#" class="btn btn-secondary" id="downloadReportBtn" style="text-decoration:none; display:flex; align-items:center; justify-content:center;">ğŸ“„ ä¸‹è½½ã€ŠROIæµ‹ç®—æŠ¥å‘Šã€‹</a>
    </div>
  </div>

  <script>
    const seriesList = [
      { key:'royal', name:'å¾¡ Royal å°Šè´µå‹ Â· ä¼ºæœæ¶²å‹é«˜ç²¾å¯†ç³»åˆ—', cap:'æœ€å¤§åšåº¦ 100mmï½œæœ€å¤§å®½åº¦ â‰¤2100mmï¼Œæœ€é«˜ç²¾åº¦0.01mm', use:'æ–°èƒ½æºåšæ¿ã€å†›å·¥ã€èˆ¹èˆ¶ã€é•œé¢æ¿ã€æ¿€å…‰åˆ‡å‰²ä»¶', tech:'ä¼ºæœ+æ¶²å‹æ··åˆã€å¾®ç±³çº§ç²¾åº¦ï¼ˆ0.01mmï¼‰ã€é˜²å¡Œè§’ã€é™éŸ³ã€ä¸ä¼ ç»Ÿæ¶²å‹ç›¸æ¯”ï¼ŒèŠ‚çœ70%èƒ½è€—ï¼Œç»¿è‰²ç¯ä¿ï¼Œå‡å°‘ææ–™æŸè€—ï¼Œæé«˜ç”Ÿäº§æ•ˆç‡ï¼Œä¸”ç»´æŠ¤æˆæœ¬æ›´ä½', priceRange:'Â¥100ä¸‡â€“Â¥350+ä¸‡', basePrice:2200000 },
      { key:'wits', name:'æ‚Ÿ Wits æ——èˆ°å‹ Â· æ™ºæ…§æ•°æ§è¶…çŸ«ç³»åˆ—', cap:'æœ€å¤§åšåº¦ 20mmï½œæœ€å¤§å®½åº¦ â‰¤2100mmï¼Œæœ€é«˜ç²¾åº¦0.01mm', use:'ä¸é”ˆé’¢/é“æ¿å®¶ç”µé¢æ¿ã€æ±½è½¦è¦†ç›–ä»¶ã€é«˜è¡¨é¢è´¨é‡è–„æ¿', tech:'ä¼ºæœæœºç”µçŸ«å¹³é—´éš™æ§åˆ¶ï¼Œè‡ªç ”è¶…çŸ«ç³»ç»Ÿã€æ™ºèƒ½è¾Šç›’æŠ½å‡ºæ¸…æ´ç³»ç»Ÿã€å¿«é€Ÿè½»æ¾åœ°æ¸…æ´çŸ«å¹³è¾Šå’Œæ”¯æ’‘è¾Šã€éå‡¡å¤§å¸ˆå®é©¬æ¼†ï¼Œå¤šå±‚ç²¾å·¥æ¶‚è£…å·¥è‰ºã€éšæ—¶ä¿®æ”¹ã€å‚¨å­˜ã€è°ƒç”¨å·¥è‰ºå’Œç¼–è¾‘è®¾å¤‡å‚æ•°çš„åŠŸèƒ½', priceRange:'Â¥90ä¸‡â€“Â¥250+ä¸‡', basePrice:1300000 },
      { key:'mastery', name:'æ…§ Mastery è±ªåå‹ Â· æ™ºæ…§æ•°æ§ç²¾å¯†çŸ«å¹³ç³»åˆ—', cap:'æœ€å¤§åšåº¦ 40mmï½œæœ€å¤§å®½åº¦ â‰¤2100mmï¼Œæœ€å¿«10mæ¯åˆ†é’Ÿ', use:'é€šç”¨é’£é‡‘ã€æœºç®±æœºæŸœã€äº”é‡‘å†²å‹ã€ä¸­åšæ¿é«˜ç²¾åº¦éœ€æ±‚', tech:'ä¼˜è´¨æ€§èƒ½ï¼Œè¶…é«˜æ€§ä»·æ¯”ï¼Œé‡‡ç”¨ç²¾å¯†ç”µæœºé©±åŠ¨ï¼Œèƒ½è€—é™ä½50%ã€æœ€å¤§åŒ–çš„æŠ•èµ„ä»·å€¼å›æŠ¥ã€æ™ºèƒ½æ•°æ§è°ƒèŠ‚ï¼Œè‡ªåŠ¨åŒ–è¿ä½œï¼Œæ˜“æ“ä½œï¼Œä¸Šæ‰‹å¿«ï¼Œæ™ºèƒ½åŒ–ç®¡ç†ï¼Œæå‡æ•ˆç‡', priceRange:'Â¥40ä¸‡â€“Â¥90+ä¸‡', basePrice:650000 },
      { key:'vague', name:'æ¸º Vague åŸºç¡€å‹ Â· äºŒå››é‡æ™®é€šçŸ«å¹³ç³»åˆ—', cap:'æœ€å¤§åšåº¦ 20mmï½œæœ€å¤§å®½åº¦ â‰¤1600mm', use:'å°å‹åŠ å·¥å‚ã€ä½é¢‘ç”Ÿäº§ã€é¢„ç®—æœ‰é™ã€æ‰‹åŠ¨æ“ä½œå¯æ¥å—', tech:'ç´§å‡‘å‹è®¾è®¡ï¼Œä½“ç§¯è¾ƒå°ï¼Œæœ€å¤§åŒ–ç©ºé—´åˆ©ç”¨ï¼Œé€‚åˆç©ºé—´æœ‰é™çš„å·¥ä½œç¯å¢ƒï¼Œä½èƒ½è€—è¿ä½œï¼ŒåŒ…è¾›æ ¼æ•ˆåº”åå¤å¼¯æ›²ã€ç»“æ„ç®€å•ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œå¿«é€Ÿå®ç°æŠ•èµ„å›æŠ¥', priceRange:'Â¥10ä¸‡â€“Â¥20+ä¸‡', basePrice:180000 }
    ]

    // åŠ¨æ€ä»·æ ¼è®¡ç®—å‡½æ•°ï¼ˆåŸºäºè¡Œä¸šã€æè´¨ã€åšåº¦ã€å®½åº¦ç­‰ï¼‰
    function calculatePrice(seriesKey) {
      const series = seriesList.find(s => s.key === seriesKey)
      if(!series) return seriesList[2].basePrice
      
      let price = series.basePrice
      const thickness = parseFloat(state.thicknessMax) || 3.0
      const width = parseFloat(state.maxWidth) || 1500
      const material = state.material || 'å†·è½§é’¢'
      
      // æ ¹æ®åšåº¦è°ƒæ•´ä»·æ ¼ï¼ˆåšåº¦è¶Šå¤§ï¼Œä»·æ ¼è¶Šé«˜ï¼‰
      if(seriesKey === 'royal') {
        if(thickness > 60) price *= 1.3
        else if(thickness > 40) price *= 1.15
        else if(thickness > 20) price *= 1.05
      } else if(seriesKey === 'mastery') {
        if(thickness > 30) price *= 1.2
        else if(thickness > 20) price *= 1.1
      }
      
      // æ ¹æ®å®½åº¦è°ƒæ•´ä»·æ ¼ï¼ˆå®½åº¦è¶Šå¤§ï¼Œä»·æ ¼è¶Šé«˜ï¼‰
      if(width > 1800) price *= 1.15
      else if(width > 1500) price *= 1.08
      else if(width > 1200) price *= 1.03
      
      // æ ¹æ®æè´¨è°ƒæ•´ä»·æ ¼ï¼ˆç‰¹æ®Šæè´¨ä»·æ ¼æ›´é«˜ï¼‰
      const materialName = material.includes('ï¼š') ? material.split('ï¼š')[0] : material
      if(['ä¸é”ˆé’¢','é’›åˆé‡‘','é•åˆé‡‘'].includes(materialName) || material.includes('é’›åˆé‡‘') || material.includes('é•åˆé‡‘')) {
        price *= 1.1
      } else if(['é“æ¿','é»„é“œ'].includes(materialName) || material.includes('é“') || material.includes('é»„é“œ')) {
        price *= 1.05
      }
      
      // æ ¹æ®å¹´åŠ å·¥é‡è°ƒæ•´ï¼ˆé‡å¤§å¯èƒ½æœ‰ä¸€å®šä¼˜æƒ ï¼Œä½†éæ ‡è®¾å¤‡é€šå¸¸ä»·æ ¼å›ºå®šï¼‰
      const tons = parseFloat(state.annualTons) || 10000
      if(tons > 10000 && seriesKey !== 'vague') {
        price *= 0.98  // å¤§å®¢æˆ·å¯èƒ½æœ‰å°å¹…ä¼˜æƒ 
      }
      
      return Math.round(price)
    }

    let state = {
      industry: 'é€šç”¨é’£é‡‘',
      material: 'å†·è½§é’¢',
      otherMaterial: '',
      thicknessMax: 3.0,
      maxWidth: 1500,
      annualTons: 10000,
      pains: [],
      otherPain: '',
      recommendedKey: 'mastery',
      selectedSeriesKey: null,  // ç”¨æˆ·é€‰æ‹©çš„ç³»åˆ—
      s1_reduce: 70,  // å‡å°‘ææ–™æŠ¥åºŸæ¯”ä¾‹
      s2_reduce: 80,  // å‡å°‘è¿”å·¥å·¥æ—¶æ¯”ä¾‹
      s3_reduce: 15   // æå‡ç”Ÿäº§æ•ˆç‡æ¯”ä¾‹ï¼ˆå›ºå®š15%ï¼‰
    }

    function money(n) {
      return new Intl.NumberFormat('zh-CN', { style:'currency', currency:'CNY', maximumFractionDigits:0 }).format(n||0)
    }

    function chooseSeries() {
      const tMax = parseFloat(state.thicknessMax) || 3.0
      const w = parseFloat(state.maxWidth) || 1500
      const mat = state.material || 'å†·è½§é’¢'
      const materialName = mat.includes('ï¼š') ? mat.split('ï¼š')[0] : mat
      const tons = parseFloat(state.annualTons) || 10000
      const pains = state.pains || []
      const industry = state.industry || 'é€šç”¨é’£é‡‘'
      
      // è¯„åˆ†ç³»ç»Ÿï¼šæ¯ä¸ªç³»åˆ—æ ¹æ®å¤šä¸ªå› ç´ è¯„åˆ†
      const scores = {
        royal: 0,
        wits: 0,
        mastery: 0,
        vague: 0
      }
      
      // 0. è¡Œä¸šç‰¹æ€§è¯„åˆ†
      if(['èˆªç©ºèˆªå¤©','å†›å·¥','æ ¸ç”µ','å‹åŠ›å®¹å™¨'].includes(industry)) {
        scores.royal += 50  // é«˜ç«¯è¡Œä¸šéœ€è¦é«˜ç²¾åº¦è®¾å¤‡
        scores.wits += 20
        scores.mastery += 10
        scores.vague += 0
      } else if(['ç²¾å¯†ç”µå­','åŒ»ç–—å™¨æ¢°','æ–°èƒ½æºç”µæ± '].includes(industry)) {
        scores.wits += 40  // ç²¾å¯†è¡Œä¸šéœ€è¦é«˜è¡¨é¢è´¨é‡
        scores.royal += 30
        scores.mastery += 20
        scores.vague += 5
      } else if(['é‡å‹æ¨¡å…·','å»ºç­‘é’¢æ„'].includes(industry)) {
        scores.royal += 35  // åšæ¿éœ€æ±‚
        scores.mastery += 40
        scores.wits += 10
        scores.vague += 10
      } else if(['æœºç®±æœºæŸœ','æ¿€å…‰åˆ‡å‰²','é€šç”¨é’£é‡‘','è‡ªåŠ¨åŒ–è®¾å¤‡'].includes(industry)) {
        scores.mastery += 35  // é€šç”¨è¡Œä¸šæ€§ä»·æ¯”ä¼˜å…ˆ
        scores.wits += 25
        scores.royal += 15
        scores.vague += 20
      } else {
        scores.mastery += 30
        scores.wits += 20
        scores.royal += 15
        scores.vague += 25
      }
      
      // 1. åšåº¦åŒ¹é…åº¦è¯„åˆ†ï¼ˆåšåº¦è¶Šå¤§ï¼Œé«˜ç«¯ç³»åˆ—å¾—åˆ†è¶Šé«˜ï¼‰
      if(tMax > 40) {
        scores.royal += 100  // åªæœ‰Royalæ”¯æŒ
        scores.mastery += 20
      } else if(tMax > 20) {
        scores.royal += 60
        scores.mastery += 80  // Masteryæœ€é€‚åˆ
        scores.wits += 10
      } else if(tMax > 10) {
        scores.royal += 30
        scores.mastery += 70
        scores.wits += 60
        scores.vague += 50
      } else {
        scores.royal += 10
        scores.mastery += 50
        scores.wits += 80  // è–„æ¿Witsæœ€æ“…é•¿
        scores.vague += 60
      }
      
      // 2. å®½åº¦åŒ¹é…åº¦è¯„åˆ†
      if(w > 2100) {
        scores.royal += 100  // åªæœ‰Royalæ”¯æŒ
        scores.wits += 100
        scores.mastery += 100
      } else if(w > 1800) {
        scores.royal += 80
        scores.wits += 80
        scores.mastery += 80
        scores.vague += 0
      } else if(w > 1600) {
        scores.royal += 60
        scores.wits += 60
        scores.mastery += 60
        scores.vague += 0
      } else {
        scores.royal += 40
        scores.wits += 40
        scores.mastery += 40
        scores.vague += 50  // Vagueæ”¯æŒâ‰¤1600mm
      }
      
      // 3. æè´¨ç‰¹æ€§è¯„åˆ†ï¼ˆä¸é”ˆé’¢/é“æ¿é€‚åˆWitsï¼‰
      if(['ä¸é”ˆé’¢','é“æ¿'].includes(materialName) || mat.includes('ä¸é”ˆé’¢') || mat.includes('é“')) {
        scores.wits += 50  // Witsä¸“é•¿
        scores.royal += 30
        scores.mastery += 20
        scores.vague += 10
      } else if(['é’›åˆé‡‘','é•åˆé‡‘'].includes(materialName) || mat.includes('é’›') || mat.includes('é•')) {
        scores.royal += 40  // é«˜ç«¯æè´¨é€‚åˆé«˜ç«¯è®¾å¤‡
        scores.wits += 30
        scores.mastery += 20
        scores.vague += 5
      } else {
        scores.mastery += 30  // é€šç”¨æè´¨Masteryæ€§ä»·æ¯”é«˜
        scores.royal += 20
        scores.wits += 20
        scores.vague += 25
      }
      
      // 4. å¹´åŠ å·¥é‡è¯„åˆ†ï¼ˆé‡å¤§é€‚åˆé«˜ç«¯ç³»åˆ—ï¼‰
      if(tons > 10000) {
        scores.royal += 40
        scores.wits += 35
        scores.mastery += 30
        scores.vague += 5
      } else if(tons > 5000) {
        scores.royal += 25
        scores.wits += 30
        scores.mastery += 40  // ä¸­ç­‰é‡Masteryæ€§ä»·æ¯”æœ€é«˜
        scores.vague += 10
      } else if(tons > 1000) {
        scores.royal += 15
        scores.wits += 25
        scores.mastery += 35
        scores.vague += 20
      } else {
        scores.royal += 5
        scores.wits += 10
        scores.mastery += 20
        scores.vague += 40  // å°é‡Vagueæœ€åˆé€‚
      }
      
      // 5. ç—›ç‚¹éœ€æ±‚è¯„åˆ†
      if(pains.includes('è¡¨é¢æœ‰å‹ç—•æˆ–è¾Šå°')) {
        scores.wits += 50  // Witsä¸“é•¿è¡¨é¢è´¨é‡
        scores.royal += 40
        scores.mastery += 20
        scores.vague += 5
      }
      if(pains.includes('å®¢æˆ·å› å¹³æ•´åº¦é—®é¢˜é€€è´§')) {
        scores.wits += 40
        scores.royal += 45
        scores.mastery += 25
        scores.vague += 5
      }
      if(pains.includes('æ¯å¤©éœ€è¿”å·¥ >1 å°æ—¶')) {
        scores.royal += 30
        scores.wits += 35
        scores.mastery += 30
        scores.vague += 10
      }
      if(pains.includes('ç„Šæ¥åä¸¥é‡å˜å½¢')) {
        scores.royal += 35
        scores.mastery += 30
        scores.wits += 25
        scores.vague += 15
      }
      
      // 6. æ€§ä»·æ¯”å¹³è¡¡ï¼ˆé¿å…è¿‡åº¦æ¨èé«˜ç«¯ï¼‰
      // å¦‚æœåšåº¦â‰¤20mmä¸”å®½åº¦â‰¤1600mmï¼ŒVagueæ€§ä»·æ¯”åŠ åˆ†
      if(tMax <= 20 && w <= 1600 && tons < 5000) {
        scores.vague += 30
      }
      // å¦‚æœåšåº¦é€‚ä¸­ä¸”é‡å¤§ï¼ŒMasteryæ€§ä»·æ¯”åŠ åˆ†
      if(tMax <= 40 && tMax > 10 && tons > 2000 && tons < 10000) {
        scores.mastery += 25
      }
      
      // æ‰¾å‡ºå¾—åˆ†æœ€é«˜çš„ç³»åˆ—
      let maxScore = -1
      let bestSeries = 'mastery'
      for(const [key, score] of Object.entries(scores)) {
        if(score > maxScore) {
          maxScore = score
          bestSeries = key
        }
      }
      
      return bestSeries
    }

    function renderSeries() {
      const recommended = chooseSeries()
      state.recommendedKey = recommended
      // å¦‚æœç”¨æˆ·è¿˜æ²¡æœ‰é€‰æ‹©ï¼Œé»˜è®¤ä½¿ç”¨æ¨èçš„ç³»åˆ—
      if(!state.selectedSeriesKey) {
        state.selectedSeriesKey = recommended
      }
      const container = document.getElementById('seriesContainer')
      if(!container) {
        console.error('seriesContainer å…ƒç´ æœªæ‰¾åˆ°')
        return
      }
      
      // å°†æ¨èé¡¹æ’åœ¨é¦–ä½
      const sortedSeries = [...seriesList].sort((a, b) => {
        if(a.key === recommended) return -1
        if(b.key === recommended) return 1
        return 0
      })
      
      container.innerHTML = sortedSeries.map(s => {
        const dynamicPrice = calculatePrice(s.key)
        return `
        <div class="card series-card ${s.key===recommended ? 'recommended' : ''} ${s.key===state.selectedSeriesKey ? 'selected' : ''}" style="padding:12px; position:relative;">
          <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
            <strong>${s.name}</strong>
            ${s.key===recommended ? '<span class="badge-special">ç‰¹åˆ«æ¨è</span>' : ''}
          </div>
          <div class="hint"><strong>èƒ½åŠ›ï¼š</strong>${s.cap}</div>
          <div class="hint"><strong>é€‚ç”¨ï¼š</strong>${s.use}</div>
          <div class="hint"><strong>ä¼˜åŠ¿ï¼š</strong>${s.tech}</div>
          <div class="hint"><strong>ä»·æ ¼åŒºé—´ï¼š</strong>${s.priceRange}</div>
          <div style="font-weight:700; margin-top:8px; margin-bottom:12px; color:var(--primary);">æœ¬æ–¹æ¡ˆå‚è€ƒä»·ï¼š${money(dynamicPrice)}</div>
          <button class="btn ${s.key===state.selectedSeriesKey ? 'btn-primary' : 'btn-secondary'}" data-series="${s.key}" style="width:100%;">${s.key===state.selectedSeriesKey ? 'âœ“ å·²é€‰æ‹©' : 'é€‰æ‹©æ­¤ç³»åˆ—'}</button>
        </div>
      `}).join('')
      
      // æ·»åŠ é€‰æ‹©äº‹ä»¶
      container.querySelectorAll('[data-series]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const seriesKey = e.target.dataset.series
          const oldKey = state.selectedSeriesKey
          state.selectedSeriesKey = seriesKey
          renderSeries() // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°é€‰æ‹©çŠ¶æ€
          
          // å¦‚æœå·²æ˜¾ç¤ºROIè¾“å…¥é¡µé¢ï¼Œæ›´æ–°æ˜¾ç¤ºçŠ¶æ€å’Œé»˜è®¤å€¼
          const roiInputSection = document.getElementById('roiInputSection')
          if(roiInputSection && roiInputSection.style.display !== 'none') {
            // æ›´æ–°æ˜¾ç¤ºçŠ¶æ€ï¼ˆèƒ½è€—èŠ‚çœé¡¹å¯èƒ½å› ç³»åˆ—å˜åŒ–è€Œæ˜¾ç¤º/éšè—ï¼‰
            updateSavingsVisibility()
            
            // å¦‚æœæ”¹å˜äº†ç³»åˆ—ï¼Œé‡æ–°åˆå§‹åŒ–é»˜è®¤å€¼
            if(oldKey !== seriesKey) {
              roiInputSection.removeAttribute('data-initialized')
              const defaults = calculateSmartDefaults()
              
              // 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Š
              const s1OldCapacity = document.getElementById('s1_oldCapacity')
              const s1NewCapacity = document.getElementById('s1_newCapacity')
              if(s1OldCapacity && !s1OldCapacity.hasAttribute('data-user-modified')) {
                s1OldCapacity.value = defaults.s1_oldCapacity
              }
              if(s1NewCapacity && !s1NewCapacity.hasAttribute('data-user-modified')) {
                s1NewCapacity.value = defaults.s1_newCapacity
              }
              
              // 2. ææ–™åˆ©ç”¨ç‡æå‡
              const s2OldRate = document.getElementById('s2_oldRate')
              const s2NewRate = document.getElementById('s2_newRate')
              if(s2OldRate && !s2OldRate.hasAttribute('data-user-modified')) {
                s2OldRate.value = defaults.s2_oldRate
              }
              if(s2NewRate && !s2NewRate.hasAttribute('data-user-modified')) {
                s2NewRate.value = defaults.s2_newRate
              }
              
              // 3. äººå·¥æˆæœ¬èŠ‚çº¦
              const s3NewWorkers = document.getElementById('s3_newWorkers')
              if(s3NewWorkers && !s3NewWorkers.hasAttribute('data-user-modified')) {
                s3NewWorkers.value = defaults.s3_newWorkers
              }
              
              // 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½
              const s4EnergyCost = document.getElementById('s4_energyCost')
              const s4EnergySaveRate = document.getElementById('s4_energySaveRate')
              const s4EnergySaveRateDisplay = document.getElementById('s4_energySaveRateDisplay')
              if(s4EnergyCost && !s4EnergyCost.hasAttribute('data-user-modified')) {
                s4EnergyCost.value = defaults.s4_energyCost
              }
              if(s4EnergySaveRate && !s4EnergySaveRate.hasAttribute('data-user-modified')) {
                s4EnergySaveRate.value = defaults.s4_energySaveRate
                // æ›´æ–°æ˜¾ç¤ºæ–‡æœ¬
                if(s4EnergySaveRateDisplay) {
                  s4EnergySaveRateDisplay.textContent = defaults.s4_energySaveRate + '%ï¼ˆæ ¹æ®è®¾å¤‡ç³»åˆ—è‡ªåŠ¨è®¡ç®—ï¼‰'
                }
              }
              
              roiInputSection.setAttribute('data-initialized', 'true')
            }
            
            // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤ï¼Œä¸å†éœ€è¦æ›´æ–°
          }
        })
      })
    }

    function showStep2() {
      console.log('showStep2 è¢«è°ƒç”¨')
      try {
        // éšè—ç¬¬ä¸€æ­¥
        const step1 = document.getElementById('step1')
        if(step1) {
          step1.style.display = 'none'
          console.log('step1 å·²éšè—')
        } else {
          console.error('step1 æœªæ‰¾åˆ°')
        }
        
        // åˆå§‹åŒ–é€‰æ‹©ä¸ºæ¨èçš„ç³»åˆ—
        if(!state.selectedSeriesKey) {
          state.selectedSeriesKey = state.recommendedKey
        }
        
        // æ˜¾ç¤ºç¬¬äºŒæ­¥
        const step2 = document.getElementById('step2')
        if(step2) {
          step2.style.display = 'block'
          console.log('step2 å·²æ˜¾ç¤º')
          
          // ç¡®ä¿è¿”å›æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š
          const backToStep1Btn = document.getElementById('backToStep1Btn')
          if(backToStep1Btn) {
            backToStep1Btn.onclick = (e) => {
              e.preventDefault()
              backToStep1()
            }
          }
          
          // æ»šåŠ¨åˆ°ç¬¬äºŒæ­¥
          setTimeout(() => {
            step2.scrollIntoView({ behavior: 'smooth', block: 'start' })
          }, 100)
        } else {
          console.error('step2 æœªæ‰¾åˆ°')
          alert('é”™è¯¯ï¼šæ‰¾ä¸åˆ°è®¾å¤‡æ¨èé¡µé¢')
        }
      } catch(err) {
        console.error('showStep2 é”™è¯¯:', err)
        alert('å‘ç”Ÿé”™è¯¯ï¼š' + err.message)
      }
    }

    // æ ¹æ®ææ–™ã€ç”Ÿäº§æƒ…å†µã€é€‰æ‹©çš„ç³»åˆ—æ™ºèƒ½è®¡ç®—é»˜è®¤å€¼
    function calculateSmartDefaults() {
      const selectedKey = state.selectedSeriesKey || state.recommendedKey
      const material = state.material || 'å†·è½§é’¢'
      const materialName = material.includes('ï¼š') ? material.split('ï¼š')[0] : material
      const thickness = parseFloat(state.thicknessMax) || 3.0
      const width = parseFloat(state.maxWidth) || 1500
      const tons = parseFloat(state.annualTons) || 10000
      const pains = state.pains || []
      const industry = state.industry || 'é€šç”¨é’£é‡‘'
      
      const defaults = {
        // 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Š
        s1_oldCapacity: 0,        // åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡ï¼ˆå¨ï¼‰ï¼Œå°†æ ¹æ®å¹´åŠ å·¥é‡è®¡ç®—
        s1_newCapacity: 0,        // æ–°è®¾å¤‡æ¯å°æ—¶å¤„ç†é‡ï¼ˆå¨ï¼‰ï¼Œå°†æ ¹æ®è¡Œä¸šå¸¸è§„å®æµ‹äº§èƒ½è®¡ç®—
        s1_workDays: 275,         // å¹´å·¥ä½œæ—¥ï¼ˆå¤©ï¼‰ï¼Œå›ºå®šå€¼
        s1_workHours: 2200,       // å¹´å·¥ä½œå°æ—¶æ•°ï¼ˆ275å¤© Ã— 8å°æ—¶ï¼‰ï¼Œå›ºå®šå€¼
        s1_profitPerTon: 100,     // å•ä½äº§å“åˆ©æ¶¦ï¼ˆå…ƒ/å¨ï¼‰
        
        // 2. ææ–™åˆ©ç”¨ç‡æå‡
        s2_oldRate: 85,           // åŸåˆæ ¼ç‡ï¼ˆ%ï¼‰
        s2_newRate: 97,           // æ–°åˆæ ¼ç‡ï¼ˆ%ï¼‰ï¼Œ96%~99%ï¼Œæ ¹æ®è®¾å¤‡ç³»åˆ—è®¡ç®—
        s2_materialCost: 0,        // å¹´ææ–™æˆæœ¬ï¼ˆå°†æ ¹æ®ææ–™ç±»å‹å’Œå¹´åŠ å·¥é‡è®¡ç®—ï¼‰
        
        // 3. äººå·¥æˆæœ¬èŠ‚çº¦
        s3_oldWorkers: 3,         // åŸæ“ä½œäººæ•°
        s3_newWorkers: 1,         // æ–°æ“ä½œäººæ•°ï¼ˆå›ºå®šä¸º1äººï¼‰
        s3_costPerWorker: 60000,  // é¢„ä¼°äººå‡å¹´æˆæœ¬ï¼ˆå…ƒï¼‰
        
        // 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½
        s4_energyCost: 0,         // å¹´ç”µè´¹ï¼ˆå°†æ ¹æ®å¹´åŠ å·¥é‡è®¡ç®—ï¼‰
        s4_energySaveRate: 0      // èŠ‚èƒ½æ¯”ä¾‹ï¼ˆå°†æ ¹æ®è®¾å¤‡ç³»åˆ—è®¡ç®—ï¼‰
      }
      
      // è®¡ç®—å¹´ææ–™æˆæœ¬ï¼šæ ¹æ®ææ–™ç±»å‹å’Œå¹´åŠ å·¥é‡
      // æ³¨æ„ï¼šè¿™é‡Œçš„ææ–™å•ä»·åº”è¯¥æ˜¯ææ–™é‡‡è´­æˆæœ¬ï¼Œè€Œä¸æ˜¯ææ–™æœ¬èº«çš„å¸‚åœºä»·å€¼
      // å¯¹äºé«˜ä»·å€¼ææ–™ï¼Œæˆ‘ä»¬éœ€è¦æ›´åˆç†çš„è®¡ç®—æ–¹å¼
      let materialPricePerTon = 5000  // é»˜è®¤å†·è½§é’¢
      
      if(['ä¸é”ˆé’¢','é’›åˆé‡‘','é•åˆé‡‘'].includes(materialName) || material.includes('ä¸é”ˆé’¢') || material.includes('é’›') || material.includes('é•')) {
        if(materialName.includes('é’›') || material.includes('é’›åˆé‡‘')) {
          materialPricePerTon = 60000  // é’›åˆé‡‘ï¼ˆé™ä½ï¼Œæ›´åˆç†çš„é‡‡è´­æˆæœ¬ï¼‰
        } else if(materialName.includes('é•') || material.includes('é•åˆé‡‘')) {
          materialPricePerTon = 20000  // é•åˆé‡‘ï¼ˆé™ä½ï¼‰
        } else {
          materialPricePerTon = 15000  // ä¸é”ˆé’¢ï¼ˆé™ä½ï¼‰
        }
      } else if(['é“æ¿','é»„é“œ'].includes(materialName) || material.includes('é“') || material.includes('é»„é“œ')) {
        if(materialName.includes('é»„é“œ')) {
          materialPricePerTon = 45000  // é»„é“œï¼ˆé™ä½ï¼‰
        } else {
          materialPricePerTon = 15000  // é“æ¿ï¼ˆé™ä½ï¼‰
        }
      } else if(materialName.includes('é“œ')) {
        materialPricePerTon = 55000  // é“œï¼ˆé™ä½ï¼‰
      } else if(materialName.includes('çƒ­è½§')) {
        materialPricePerTon = 4500  // çƒ­è½§é’¢
      } else if(materialName.includes('é•€é”Œ')) {
        materialPricePerTon = 5500  // é•€é”Œæ¿
      } else {
        materialPricePerTon = 5000  // å†·è½§é’¢
      }
      
      // å¹´ææ–™æˆæœ¬ = å¹´åŠ å·¥é‡ Ã— ææ–™å•ä»·
      // ä½†ä¸ºäº†æ›´ä¿å®ˆï¼Œå¯¹äºé«˜ä»·å€¼ææ–™ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªä¸Šé™
      let annualMaterialCost = tons * materialPricePerTon
      
      // è®¾ç½®å¹´ææ–™æˆæœ¬ä¸Šé™ï¼šä¸è¶…è¿‡5000ä¸‡ï¼ˆé¿å…è¿‡é«˜ï¼‰
      if(annualMaterialCost > 50000000) {
        annualMaterialCost = 50000000
      }
      
      defaults.s2_materialCost = Math.round(annualMaterialCost)
      
      // è®¡ç®—åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡ï¼ˆå¨ï¼‰= å¹´åŠ å·¥é‡ / 12
      defaults.s1_oldCapacity = Math.round((tons / 12) * 100) / 100  // ä¿ç•™2ä½å°æ•°
      
      // ========== ä¼˜åŒ–æ–°è®¾å¤‡äº§èƒ½è®¡ç®—é€»è¾‘ ==========
      // é—®é¢˜ï¼šä¹‹å‰åŸºäºå¹´åŠ å·¥é‡è®¡ç®—æ–°è®¾å¤‡äº§èƒ½ï¼Œå¯¼è‡´äº§èƒ½å·®å€¼è¿‡å¤§
      // ä¿®æ­£ï¼šæ–°è®¾å¤‡äº§èƒ½åº”è¯¥åŸºäºåŸè®¾å¤‡äº§èƒ½çš„æå‡ï¼Œè€Œä¸æ˜¯åŸºäºå¹´åŠ å·¥é‡
      
      // è®¡ç®—åŸè®¾å¤‡æ¯å°æ—¶å¤„ç†é‡ï¼ˆå¨/å°æ—¶ï¼‰
      // å‡è®¾æ¯æœˆ22ä¸ªå·¥ä½œæ—¥ï¼Œæ¯å¤©8å°æ—¶ï¼Œåˆ™æ¯æœˆå·¥ä½œå°æ—¶æ•° = 22 Ã— 8 = 176å°æ—¶
      const oldCapacityHourly = defaults.s1_oldCapacity / 176  // åŸè®¾å¤‡æ¯å°æ—¶å¤„ç†é‡
      
      // æ ¹æ®è®¾å¤‡ç³»åˆ—è®¡ç®—æ•ˆç‡æå‡ç™¾åˆ†æ¯”ï¼ˆæ›´ä¿å®ˆçš„æå‡å¹…åº¦ï¼‰
      let efficiencyImprovement = 0  // æ•ˆç‡æå‡ç™¾åˆ†æ¯”
      if(selectedKey === 'royal') {
        efficiencyImprovement = 0.5  // Royalæ•ˆç‡æå‡50%ï¼ˆé™ä½ï¼Œä¹‹å‰æ˜¯80%ï¼‰
      } else if(selectedKey === 'wits') {
        efficiencyImprovement = 0.4  // Witsæ•ˆç‡æå‡40%ï¼ˆé™ä½ï¼Œä¹‹å‰æ˜¯60%ï¼‰
      } else if(selectedKey === 'mastery') {
        efficiencyImprovement = 0.3  // Masteryæ•ˆç‡æå‡30%ï¼ˆé™ä½ï¼Œä¹‹å‰æ˜¯50%ï¼‰
      } else {
        efficiencyImprovement = 0.2  // Vagueæ•ˆç‡æå‡20%ï¼ˆé™ä½ï¼Œä¹‹å‰æ˜¯30%ï¼‰
      }
      
      // æ–°è®¾å¤‡æ¯å°æ—¶å¤„ç†é‡ = åŸè®¾å¤‡æ¯å°æ—¶å¤„ç†é‡ Ã— (1 + æ•ˆç‡æå‡ç™¾åˆ†æ¯”)
      defaults.s1_newCapacity = Math.round(oldCapacityHourly * (1 + efficiencyImprovement) * 100) / 100
      
      // æ ¹æ®å¹´åŠ å·¥é‡è°ƒæ•´å•ä½äº§å“åˆ©æ¶¦
      if(tons > 10000) {
        defaults.s1_profitPerTon = 120  // å¤§é‡ç”Ÿäº§åˆ©æ¶¦æ›´é«˜
      } else if(tons > 5000) {
        defaults.s1_profitPerTon = 110
      } else {
        defaults.s1_profitPerTon = 100
      }
      
      // æ ¹æ®è®¾å¤‡ç³»åˆ—è°ƒæ•´åˆæ ¼ç‡ï¼ˆæ–°åˆæ ¼ç‡96%~99%ï¼‰
      if(selectedKey === 'royal') {
        defaults.s2_oldRate = 80
        defaults.s2_newRate = 99  // Royalæœ€é«˜ç²¾åº¦ï¼Œ99%
      } else if(selectedKey === 'wits') {
        defaults.s2_oldRate = 82
        defaults.s2_newRate = 98  // Witsé«˜è¡¨é¢è´¨é‡ï¼Œ98%
      } else if(selectedKey === 'mastery') {
        defaults.s2_oldRate = 85
        defaults.s2_newRate = 97  // Masteryå¹³è¡¡ï¼Œ97%
      } else {
        defaults.s2_oldRate = 85
        defaults.s2_newRate = 96  // VagueåŸºç¡€ï¼Œ96%
      }
      
      // æ ¹æ®ç—›ç‚¹è°ƒæ•´åˆæ ¼ç‡
      if(pains.includes('å®¢æˆ·å› å¹³æ•´åº¦é—®é¢˜é€€è´§')) {
        defaults.s2_oldRate = Math.min(defaults.s2_oldRate, 75)  // é€€è´§è¯´æ˜åˆæ ¼ç‡è¾ƒä½
        defaults.s2_newRate = Math.max(defaults.s2_newRate, 99)  // æ–°è®¾å¤‡å¤§å¹…æå‡
      }
      
      // æ–°è®¾å¤‡æ“ä½œäººæ•°å›ºå®šä¸º1äºº
      defaults.s3_newWorkers = 1
      
      // æ ¹æ®è¡Œä¸šè°ƒæ•´äººå‡å¹´æˆæœ¬
      if(['èˆªç©ºèˆªå¤©','å†›å·¥','æ ¸ç”µ','å‹åŠ›å®¹å™¨','ç²¾å¯†ç”µå­','åŒ»ç–—å™¨æ¢°'].includes(industry)) {
        defaults.s3_costPerWorker = 80000  // é«˜ç«¯è¡Œä¸šäººå·¥æˆæœ¬æ›´é«˜
      } else if(['æ–°èƒ½æºç”µæ± ','ç”µæ¢¯','è‡ªåŠ¨åŒ–è®¾å¤‡'].includes(industry)) {
        defaults.s3_costPerWorker = 70000
      } else {
        defaults.s3_costPerWorker = 60000
      }
      
      // è®¡ç®—å¹´ç”µè´¹ï¼šæ ¹æ®å¹´åŠ å·¥é‡ä¼°ç®—
      defaults.s4_energyCost = Math.round(tons * 15)  // æ¯å¨ææ–™å¯¹åº”15å…ƒç”µè´¹
      
      // æ ¹æ®è®¾å¤‡ç³»åˆ—è®¾ç½®èŠ‚èƒ½æ¯”ä¾‹
      if(selectedKey === 'royal' || selectedKey === 'wits') {
        defaults.s4_energySaveRate = 70  // å¾¡/æ‚Ÿç³»åˆ—èŠ‚èƒ½70%
      } else if(selectedKey === 'mastery') {
        defaults.s4_energySaveRate = 50  // æ…§ç³»åˆ—èŠ‚èƒ½50%
      } else if(selectedKey === 'vague') {
        defaults.s4_energySaveRate = 30  // æ¸ºç³»åˆ—èŠ‚èƒ½30%
      } else {
        defaults.s4_energySaveRate = 0
      }
      
      return defaults
    }

    // æ ¹æ®ç—›ç‚¹åŠ¨æ€æ˜¾ç¤º/éšè—èŠ‚çœé¡¹
    function updateSavingsVisibility() {
      const selectedKey = state.selectedSeriesKey || state.recommendedKey
      
      // 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Šï¼šæ‰€æœ‰ç”¨æˆ·éƒ½æ˜¾ç¤ºï¼ˆå·²åœ¨HTMLä¸­è®¾ç½®ï¼‰
      
      // 2. ææ–™åˆ©ç”¨ç‡æå‡ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½æ˜¾ç¤ºï¼ˆå·²åœ¨HTMLä¸­è®¾ç½®ï¼‰
      
      // 3. äººå·¥æˆæœ¬èŠ‚çº¦ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½æ˜¾ç¤ºï¼ˆå·²åœ¨HTMLä¸­è®¾ç½®ï¼‰
      
      // 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½ï¼šæ‰€æœ‰ç³»åˆ—éƒ½æ˜¾ç¤º
      const s4Item = document.getElementById('savings-item-4')
      if(s4Item) s4Item.style.display = 'block'
      
      // æ ¹æ®å¹´åŠ å·¥é‡å’Œè®¾å¤‡ç³»åˆ—åŠ¨æ€è®¡ç®—èƒ½è€—èŠ‚çœ
      const s4EnergyCost = document.getElementById('s4_energyCost')
      const s4EnergySaveRate = document.getElementById('s4_energySaveRate')
      const s4EnergySaveRateDisplay = document.getElementById('s4_energySaveRateDisplay')
      
      if(s4EnergyCost && !s4EnergyCost.hasAttribute('data-user-modified')) {
        const tons = parseFloat(state.annualTons) || 10000
        // ä¼°ç®—å¹´ç”µè´¹ï¼šæ¯å¨ææ–™å¯¹åº”10-20å…ƒç”µè´¹
        const estimatedEnergyCost = Math.round(tons * 15)
        s4EnergyCost.value = estimatedEnergyCost
      }
      
      // æ ¹æ®è®¾å¤‡ç³»åˆ—è®¾ç½®èŠ‚èƒ½æ¯”ä¾‹
      let energySaveRate = 0
      let displayText = ''
      if(selectedKey === 'royal' || selectedKey === 'wits') {
        energySaveRate = 70  // å¾¡/æ‚Ÿç³»åˆ—èŠ‚èƒ½70%
        displayText = '70%'
      } else if(selectedKey === 'mastery') {
        energySaveRate = 50  // æ…§ç³»åˆ—èŠ‚èƒ½50%
        displayText = '50%'
      } else if(selectedKey === 'vague') {
        energySaveRate = 30  // æ¸ºç³»åˆ—èŠ‚èƒ½30%
        displayText = '30%'
      }
      
      if(s4EnergySaveRate) {
        s4EnergySaveRate.value = energySaveRate
      }
      
      if(s4EnergySaveRateDisplay) {
        s4EnergySaveRateDisplay.textContent = displayText + 'ï¼ˆæ ¹æ®è®¾å¤‡ç³»åˆ—è‡ªåŠ¨è®¡ç®—ï¼‰'
      }
    }

    // å®æ—¶è®¡ç®—é¢„è§ˆç»“æœï¼ˆå·²åˆ é™¤å®æ—¶æ±‡æ€»ç»“æœæ¿å—ï¼Œæ­¤å‡½æ•°ä¸å†éœ€è¦ï¼‰
    // function updatePreviewResults() { ... }

    function showStep3() {
      // æ ¹æ®ææ–™ã€ç”Ÿäº§æƒ…å†µã€é€‰æ‹©çš„ç³»åˆ—æ™ºèƒ½è®¾ç½®é»˜è®¤å€¼
      const selectedKey = state.selectedSeriesKey || state.recommendedKey
      const recSeries = seriesList.find(s => s.key === selectedKey) || seriesList[2]
      const defaults = calculateSmartDefaults()
      
      // æ ¹æ®ç—›ç‚¹åŠ¨æ€æ˜¾ç¤º/éšè—èŠ‚çœé¡¹
      updateSavingsVisibility()
      
      // è®¾ç½®é»˜è®¤å€¼ï¼ˆåªåœ¨ç¬¬ä¸€æ¬¡æ˜¾ç¤ºæ—¶è®¾ç½®ï¼Œé¿å…è¦†ç›–ç”¨æˆ·å·²è¾“å…¥çš„å€¼ï¼‰
      const roiInputSection = document.getElementById('roiInputSection')
      if(!roiInputSection.hasAttribute('data-initialized')) {
        // 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Š
        const s1OldCapacity = document.getElementById('s1_oldCapacity')
        const s1NewCapacity = document.getElementById('s1_newCapacity')
        const s1WorkDays = document.getElementById('s1_workDays')
        const s1WorkHours = document.getElementById('s1_workHours')
        const s1ProfitPerTon = document.getElementById('s1_profitPerTon')
        if(s1OldCapacity) {
          s1OldCapacity.value = defaults.s1_oldCapacity
          s1OldCapacity.removeAttribute('data-user-modified')
        }
        if(s1NewCapacity) {
          s1NewCapacity.value = defaults.s1_newCapacity
          s1NewCapacity.removeAttribute('data-user-modified')
        }
        if(s1WorkDays) {
          s1WorkDays.value = defaults.s1_workDays
        }
        if(s1WorkHours) {
          s1WorkHours.value = defaults.s1_workHours
        }
        if(s1ProfitPerTon) {
          s1ProfitPerTon.value = defaults.s1_profitPerTon
          s1ProfitPerTon.removeAttribute('data-user-modified')
        }
        
        // 2. ææ–™åˆ©ç”¨ç‡æå‡
        const s2OldRate = document.getElementById('s2_oldRate')
        const s2NewRate = document.getElementById('s2_newRate')
        const s2MaterialCost = document.getElementById('s2_materialCost')
        if(s2OldRate) {
          s2OldRate.value = defaults.s2_oldRate
          s2OldRate.removeAttribute('data-user-modified')
        }
        if(s2NewRate) {
          s2NewRate.value = defaults.s2_newRate
          s2NewRate.removeAttribute('data-user-modified')
        }
        if(s2MaterialCost) {
          s2MaterialCost.value = defaults.s2_materialCost
          s2MaterialCost.removeAttribute('data-user-modified')
        }
        
        // 3. äººå·¥æˆæœ¬èŠ‚çº¦
        const s3OldWorkers = document.getElementById('s3_oldWorkers')
        const s3NewWorkers = document.getElementById('s3_newWorkers')
        const s3CostPerWorker = document.getElementById('s3_costPerWorker')
        if(s3OldWorkers) {
          s3OldWorkers.value = defaults.s3_oldWorkers
          s3OldWorkers.removeAttribute('data-user-modified')
        }
        if(s3NewWorkers) {
          s3NewWorkers.value = defaults.s3_newWorkers
          s3NewWorkers.removeAttribute('data-user-modified')
        }
        if(s3CostPerWorker) {
          s3CostPerWorker.value = defaults.s3_costPerWorker
          s3CostPerWorker.removeAttribute('data-user-modified')
        }
        
        // 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½
        const s4EnergyCost = document.getElementById('s4_energyCost')
        const s4EnergySaveRate = document.getElementById('s4_energySaveRate')
        const s4EnergySaveRateDisplay = document.getElementById('s4_energySaveRateDisplay')
        if(s4EnergyCost) {
          s4EnergyCost.value = defaults.s4_energyCost
          s4EnergyCost.removeAttribute('data-user-modified')
        }
        if(s4EnergySaveRate) {
          s4EnergySaveRate.value = defaults.s4_energySaveRate
          s4EnergySaveRate.removeAttribute('data-user-modified')
          // æ›´æ–°æ˜¾ç¤ºæ–‡æœ¬
          if(s4EnergySaveRateDisplay) {
            s4EnergySaveRateDisplay.textContent = defaults.s4_energySaveRate + '%ï¼ˆæ ¹æ®è®¾å¤‡ç³»åˆ—è‡ªåŠ¨è®¡ç®—ï¼‰'
          }
        }
        
        roiInputSection.setAttribute('data-initialized', 'true')
      }
      
      // æ˜¾ç¤ºROIè¾“å…¥åŒºåŸŸ
      roiInputSection.style.display = 'block'
      
      // ç¡®ä¿"è®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘Š"æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š
      bindCalculateReportButton()
      
      // ç¡®ä¿è¿”å›æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š
      const backToStep2Btn = document.getElementById('backToStep2Btn')
      if(backToStep2Btn) {
        backToStep2Btn.onclick = (e) => {
          e.preventDefault()
          backToStep2()
        }
      }
      
      // æ»šåŠ¨åˆ°ROIè¾“å…¥åŒºåŸŸ
      roiInputSection.scrollIntoView({ behavior: 'smooth', block: 'start' })
    }

    function generateReport() {
      try {
        console.log('å¼€å§‹ç”ŸæˆæŠ¥å‘Š...')
        // è®¡ç®—æ‰€æœ‰æ•°æ®
        // 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Š
        // åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡ï¼ˆå¨ï¼‰
        const s1_oldCapacityMonthly = parseFloat(document.getElementById('s1_oldCapacity').value || 0)
      // æ–°è®¾å¤‡æ¯å°æ—¶å¤„ç†é‡ï¼ˆå¨/å°æ—¶ï¼‰
      const s1_newCapacity = parseFloat(document.getElementById('s1_newCapacity').value || 0)
      // å¹´å·¥ä½œå°æ—¶æ•°ï¼ˆå›ºå®šå€¼ï¼š275å¤© Ã— 8å°æ—¶ = 2200å°æ—¶ï¼‰
      const s1_workHours = parseInt(document.getElementById('s1_workHours').value || 2200)
      const s1_profitPerTon = parseFloat(document.getElementById('s1_profitPerTon').value || 0)
      
      // å°†åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡è½¬æ¢ä¸ºæ¯å°æ—¶å¤„ç†é‡
      // å‡è®¾æ¯æœˆ22ä¸ªå·¥ä½œæ—¥ï¼Œæ¯å¤©8å°æ—¶ï¼Œåˆ™æ¯æœˆå·¥ä½œå°æ—¶æ•° = 22 Ã— 8 = 176å°æ—¶
      const s1_oldCapacityHourly = s1_oldCapacityMonthly / 176  // åŸè®¾å¤‡æ¯å°æ—¶å¤„ç†é‡ï¼ˆå¨/å°æ—¶ï¼‰
      
      // ========== ä¼˜åŒ–s1è®¡ç®—é€»è¾‘ ==========
      // é—®é¢˜ï¼šæ–°è®¾å¤‡äº§èƒ½ä¸åº”è¯¥åŸºäºå¹´åŠ å·¥é‡è®¡ç®—ï¼Œè€Œåº”è¯¥åŸºäºåŸè®¾å¤‡äº§èƒ½çš„æå‡
      // ä¿®æ­£ï¼šæ–°è®¾å¤‡äº§èƒ½åº”è¯¥åŸºäºåŸè®¾å¤‡äº§èƒ½ï¼ŒæŒ‰è®¾å¤‡ç³»åˆ—æå‡æ•ˆç‡
      // ä½†è¿™é‡Œç”¨æˆ·å·²ç»è¾“å…¥äº†æ–°è®¾å¤‡äº§èƒ½ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ï¼Œä½†è¦ç¡®ä¿åˆç†æ€§
      
      // è®¡ç®—äº§èƒ½æå‡å¸¦æ¥çš„é¢å¤–åŠ å·¥é‡ï¼ˆå¨/å¹´ï¼‰
      const capacityIncreaseHourly = Math.max(0, s1_newCapacity - s1_oldCapacityHourly)  // æ¯å°æ—¶äº§èƒ½æå‡
      const capacityIncreaseAnnual = capacityIncreaseHourly * s1_workHours  // å¹´äº§èƒ½æå‡ï¼ˆå¨/å¹´ï¼‰
      
      // å¹´å¢æ”¶ç›Š = å¹´äº§èƒ½æå‡ Ã— å•ä½äº§å“åˆ©æ¶¦
      // æ³¨æ„ï¼šè¿™é‡Œåªè®¡ç®—æ–°å¢äº§èƒ½å¸¦æ¥çš„æ”¶ç›Šï¼Œè€Œä¸æ˜¯å…¨éƒ¨äº§èƒ½
      const s1 = Math.round(capacityIncreaseAnnual * s1_profitPerTon)
      
      // 2. ææ–™åˆ©ç”¨ç‡æå‡ï¼ˆä¼˜åŒ–è®¡ç®—é€»è¾‘ï¼‰
      const s2_oldRate = parseFloat(document.getElementById('s2_oldRate').value || 0)
      const s2_newRate = parseFloat(document.getElementById('s2_newRate').value || 0)
      const s2_materialCost = parseInt(document.getElementById('s2_materialCost').value || 0)
      
      // ========== è®¡ç®—åºŸå“ç‡é™ä½ï¼ˆç”¨äºåç»­ä¼˜åŒ–è®¡ç®—ï¼‰ ==========
      const oldWasteRate = (100 - s2_oldRate) / 100  // åŸåºŸå“ç‡
      const newWasteRate = (100 - s2_newRate) / 100  // æ–°åºŸå“ç‡
      const wasteReduction = oldWasteRate - newWasteRate  // åºŸå“ç‡é™ä½
      
      // åŸºç¡€s2è®¡ç®—ï¼ˆå°†åœ¨åç»­æ ¹æ®ææ–™ä»·å€¼å’ŒåŸåˆæ ¼ç‡è¿›è¡Œè°ƒæ•´ï¼‰
      const s2_base = s2_materialCost * wasteReduction
      
      // 3. äººå·¥æˆæœ¬èŠ‚çº¦ï¼šï¼ˆåŸæ“ä½œäººæ•° - æ–°æ“ä½œäººæ•°ï¼‰Ã— äººå‡å¹´æˆæœ¬
      const s3_oldWorkers = parseInt(document.getElementById('s3_oldWorkers').value || 0)
      const s3_newWorkers = parseInt(document.getElementById('s3_newWorkers').value || 0)
      const s3_costPerWorker = parseInt(document.getElementById('s3_costPerWorker').value || 0)
      const s3 = Math.max(0, (s3_oldWorkers - s3_newWorkers) * s3_costPerWorker)
      
      // 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½ï¼šå¹´ç”µè´¹ Ã— èŠ‚èƒ½æ¯”ä¾‹ / 100
      const selectedKey = state.selectedSeriesKey || state.recommendedKey
      const s4_energyCost = parseInt(document.getElementById('s4_energyCost').value || 0)
      const s4_energySaveRate = parseFloat(document.getElementById('s4_energySaveRate').value || 0)
      const s4 = Math.round(s4_energyCost * s4_energySaveRate / 100)
      
      // è·å–ç”¨æˆ·è¾“å…¥çš„æ‰€æœ‰åŸºç¡€ä¿¡æ¯
      const industry = state.industry || 'é€šç”¨é’£é‡‘'
      const material = state.material || 'å†·è½§é’¢'
      const annualTons = parseFloat(state.annualTons) || 10000
      const thickness = parseFloat(state.thicknessMax) || 3.0
      const width = parseFloat(state.maxWidth) || 1500
      const pains = state.pains || []
      const otherPain = state.otherPain || ''
      
      // ========== æ ¹æ®è¡Œä¸šå®è·µæ•°æ®ä¼˜åŒ–æ”¶ç›Šè®¡ç®— ==========
      // åŸºäº2024-2025å¹´è¡Œä¸šæŠ¥å‘Šå’Œå®æµ‹æ•°æ®ï¼Œå¯¹æ”¶ç›Šè¿›è¡Œåˆç†è°ƒæ•´
      
      // 1. æ ¹æ®ææ–™ä»·å€¼è°ƒæ•´ææ–™åˆ©ç”¨ç‡æå‡æ”¶ç›Šï¼ˆs2ï¼‰
      // é«˜é™„åŠ å€¼ææ–™ï¼ˆä¸é”ˆé’¢ã€é’›åˆé‡‘ç­‰ï¼‰çš„åºŸå“æŸå¤±æ›´å¤§ï¼Œéœ€è¦æ›´å‡†ç¡®è®¡ç®—
      const materialName = material.includes('ï¼š') ? material.split('ï¼š')[0] : material
      const isHighValueMaterial = ['ä¸é”ˆé’¢', 'é’›åˆé‡‘', 'é•åˆé‡‘', 'é“æ¿', 'é“œ', 'é»„é“œ'].includes(materialName)
      
      // å¯¹äºé«˜é™„åŠ å€¼ææ–™ï¼Œææ–™å›æ”¶ä»·å€¼æ¯”ä¾‹æ›´ä½ï¼ˆå› ä¸ºææ–™æœ¬èº«ä»·å€¼é«˜ï¼‰
      // å¯¹äºæ™®é€šææ–™ï¼Œææ–™å›æ”¶ä»·å€¼æ¯”ä¾‹å¯ä»¥æ›´é«˜
      const materialRecoveryRate = isHighValueMaterial ? 0.5 : 0.7  // é«˜ä»·å€¼ææ–™å›æ”¶ç‡50%ï¼Œæ™®é€šææ–™70%
      const adjustedS2 = Math.round(s2_base * materialRecoveryRate)
      
      // 2. æ ¹æ®åŸåˆæ ¼ç‡è°ƒæ•´ææ–™åˆ©ç”¨ç‡æå‡æ”¶ç›Š
      // åŸåˆæ ¼ç‡<80%æ—¶ï¼Œæå‡ç©ºé—´å¤§ï¼Œæ”¶ç›Šæ›´æ˜¾è‘—
      // åŸåˆæ ¼ç‡>95%æ—¶ï¼Œè¾¹é™…æ•ˆç›Šä½ï¼Œéœ€è¦é™ä½æ”¶ç›Šé¢„æœŸ
      let s2AdjustmentFactor = 1.0
      if(s2_oldRate < 80) {
        s2AdjustmentFactor = 1.0  // æå‡ç©ºé—´å¤§ï¼Œä¿æŒåŸå€¼
      } else if(s2_oldRate >= 95) {
        s2AdjustmentFactor = 0.6  // è¾¹é™…æ•ˆç›Šä½ï¼Œé™ä½60%
      } else {
        s2AdjustmentFactor = 0.8  // ä¸­ç­‰æå‡ç©ºé—´ï¼Œé™ä½20%
      }
      const finalS2 = Math.round(adjustedS2 * s2AdjustmentFactor)
      
      // 3. æ ¹æ®äº§èƒ½åˆ©ç”¨ç‡è°ƒæ•´æ•ˆç‡æå‡æ”¶ç›Šï¼ˆs1ï¼‰
      // å¦‚æœåŸè®¾å¤‡äº§èƒ½åˆ©ç”¨ç‡ä½ï¼Œæ–°è®¾å¤‡çš„æ•ˆç‡æå‡æ”¶ç›Šåº”è¯¥æ‰“æŠ˜æ‰£
      // å‡è®¾åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡ = å¹´åŠ å·¥é‡/12ï¼Œå¦‚æœè¿™ä¸ªå€¼å¾ˆå°ï¼Œè¯´æ˜äº§èƒ½åˆ©ç”¨ç‡ä½
      const capacityUtilization = annualTons > 0 ? (s1_oldCapacityMonthly * 12) / annualTons : 1.0
      let s1AdjustmentFactor = 1.0
      if(capacityUtilization < 0.5) {
        s1AdjustmentFactor = 0.7  // äº§èƒ½åˆ©ç”¨ç‡<50%ï¼Œæ•ˆç‡æå‡æ”¶ç›Šæ‰“7æŠ˜
      } else if(capacityUtilization < 0.7) {
        s1AdjustmentFactor = 0.85  // äº§èƒ½åˆ©ç”¨ç‡50%-70%ï¼Œæ‰“8.5æŠ˜
      } else {
        s1AdjustmentFactor = 1.0  // äº§èƒ½åˆ©ç”¨ç‡>70%ï¼Œä¿æŒåŸå€¼
      }
      const finalS1 = Math.round(s1 * s1AdjustmentFactor)
      
      // 4. æ ¹æ®è®¾å¤‡ç±»å‹ï¼ˆåšåº¦ï¼‰è°ƒæ•´æ•´ä½“æ”¶ç›Š
      // æ ¹æ®è¡Œä¸šæ•°æ®ï¼šè–„æ¿è®¾å¤‡ï¼ˆ0.3-3mmï¼‰ROIæ›´é«˜ï¼Œåšæ¿è®¾å¤‡ï¼ˆ25-60mmï¼‰ROIè¾ƒä½
      let thicknessAdjustmentFactor = 1.0
      if(thickness <= 3) {
        thicknessAdjustmentFactor = 1.0  // è–„æ¿ï¼Œä¿æŒåŸå€¼ï¼ˆç²¾å¯†è–„æ¿çŸ«å¹³æœºROI 85%-150%ï¼‰
      } else if(thickness <= 25) {
        thicknessAdjustmentFactor = 0.95  // ä¸­åšæ¿ï¼Œç•¥å¾®é™ä½ï¼ˆä¸­åšæ¿é€šç”¨çŸ«å¹³æœºROI 50%-100%ï¼‰
      } else {
        thicknessAdjustmentFactor = 0.85  // åšæ¿ï¼Œé™ä½15%ï¼ˆé‡å‹/è¶…åšæ¿ROI 30%-50%ï¼‰
      }
      
      // 5. æ ¹æ®è¡Œä¸šç‰¹ç‚¹è°ƒæ•´æ”¶ç›Š
      // é«˜è¦æ±‚é¢†åŸŸï¼ˆä¸é”ˆé’¢ã€æ–°èƒ½æºã€é«˜ç«¯è£…å¤‡ï¼‰å›æŠ¥æ›´å¿«
      const isHighRequirementIndustry = ['èˆªç©ºèˆªå¤©', 'å†›å·¥', 'ç²¾å¯†ç”µå­', 'åŒ»ç–—å™¨æ¢°', 'æ–°èƒ½æºç”µæ± ', 'æ ¸ç”µ'].includes(industry)
      const industryAdjustmentFactor = isHighRequirementIndustry ? 1.05 : 1.0  // é«˜è¦æ±‚è¡Œä¸šæå‡5%
      
      // è®¡ç®—è°ƒæ•´åçš„å¹´å‡€æ”¶ç›Š
      const adjustedTotal = Math.round((finalS1 + finalS2 + s3 + s4) * thicknessAdjustmentFactor * industryAdjustmentFactor)
      
      // ========== å…ˆè®¡ç®—æ€»æŠ•å…¥ï¼ˆTCOï¼‰ï¼Œå› ä¸ºåç»­è®¡ç®—éœ€è¦ç”¨åˆ° ==========
      const recSeries = seriesList.find(s => s.key === selectedKey) || seriesList[2]
      const dynamicPrice = calculatePrice(selectedKey)
      
      const investmentDevice = dynamicPrice  // è®¾å¤‡æœ¬ä½“ä»·æ ¼
      const investmentInstall = Math.round(dynamicPrice * 0.05)  // è¿è¾“ã€å®‰è£…ã€è°ƒè¯•ï¼šè®¾å¤‡ä»·æ ¼çš„5%
      const investmentAux = Math.round(dynamicPrice * 0.03)  // è¾…åŠ©é…å¥—æŠ•å…¥ï¼šè®¾å¤‡ä»·æ ¼çš„3%ï¼ˆç”µåŠ›æ”¹é€ ã€å‚æˆ¿è°ƒæ•´ã€å¤¹å…·ç­‰ï¼‰
      const investmentTraining = Math.round(dynamicPrice * 0.02)  // åŸ¹è®­ä¸äººåŠ›æˆæœ¬ï¼šè®¾å¤‡ä»·æ ¼çš„2%
      const investmentMaintenance = Math.round(dynamicPrice * 0.04)  // é¦–å¹´ç»´æŠ¤ä¸å¤‡ä»¶ï¼šè®¾å¤‡ä»·æ ¼çš„4%
      const totalInvestment = investmentDevice + investmentInstall + investmentAux + investmentTraining + investmentMaintenance
      
      // ========== æœ€ç»ˆéªŒè¯å’Œè°ƒæ•´ï¼šç¡®ä¿ROIåœ¨40%-150%ä¹‹é—´ï¼Œå›æŠ¥å‘¨æœŸåœ¨6ä¸ªæœˆ~3å¹´ä¹‹é—´ ==========
      // è®¾ç½®é™åˆ¶å€¼
      const minROI = 0.40  // æœ€ä½ROI 40%
      const maxROI = 1.50  // æœ€é«˜ROI 150%
      const minPaybackMonths = 6   // æœ€çŸ­å›æŠ¥å‘¨æœŸ 6ä¸ªæœˆ
      const maxPaybackMonths = 36  // æœ€é•¿å›æŠ¥å‘¨æœŸ 3å¹´ï¼ˆ36ä¸ªæœˆï¼‰
      
      // è®¡ç®—æ”¶ç›Šçš„åˆç†èŒƒå›´ï¼ˆåŒæ—¶æ»¡è¶³ROIå’Œå›æŠ¥å‘¨æœŸè¦æ±‚ï¼‰
      // åŸºäºROIé™åˆ¶çš„æ”¶ç›ŠèŒƒå›´
      const minTotalByROI = Math.round(totalInvestment * minROI)  // 40% ROIå¯¹åº”çš„æœ€å°å¹´æ”¶ç›Š
      const maxTotalByROI = Math.round(totalInvestment * maxROI)  // 150% ROIå¯¹åº”çš„æœ€å¤§å¹´æ”¶ç›Š
      
      // åŸºäºå›æŠ¥å‘¨æœŸé™åˆ¶çš„æ”¶ç›ŠèŒƒå›´
      const minTotalByPayback = Math.round(totalInvestment * (12 / maxPaybackMonths))  // 36ä¸ªæœˆå¯¹åº”çš„æœ€å°å¹´æ”¶ç›Š
      const maxTotalByPayback = Math.round(totalInvestment * (12 / minPaybackMonths))  // 6ä¸ªæœˆå¯¹åº”çš„æœ€å¤§å¹´æ”¶ç›Š
      
      // å–äº¤é›†ï¼šæ—¢è¦æ»¡è¶³ROIè¦æ±‚ï¼Œåˆè¦æ»¡è¶³å›æŠ¥å‘¨æœŸè¦æ±‚
      const minTotalAllowed = Math.max(minTotalByROI, minTotalByPayback)  // å–è¾ƒå¤§å€¼ï¼ˆæ›´ä¸¥æ ¼çš„ä¸‹é™ï¼‰
      const maxTotalAllowed = Math.min(maxTotalByROI, maxTotalByPayback)  // å–è¾ƒå°å€¼ï¼ˆæ›´ä¸¥æ ¼çš„ä¸Šé™ï¼‰
      
      // å¦‚æœè®¡ç®—å‡ºçš„æ”¶ç›Šè¶…å‡ºåˆç†èŒƒå›´ï¼Œè¿›è¡Œè°ƒæ•´
      let finalTotal = adjustedTotal
      let needsAdjustment = false
      
      if(finalTotal < minTotalAllowed) {
        finalTotal = minTotalAllowed
        needsAdjustment = true
        console.log(`æ”¶ç›Šè¿‡ä½ï¼ˆ${adjustedTotal}ï¼‰ï¼Œå·²è°ƒæ•´è‡³æœ€å°å€¼${minTotalAllowed}ï¼ˆç¡®ä¿ROIâ‰¥40%ä¸”å›æŠ¥å‘¨æœŸâ‰¤36ä¸ªæœˆï¼‰`)
      } else if(finalTotal > maxTotalAllowed) {
        finalTotal = maxTotalAllowed
        needsAdjustment = true
        console.log(`æ”¶ç›Šè¿‡é«˜ï¼ˆ${adjustedTotal}ï¼‰ï¼Œå·²è°ƒæ•´è‡³æœ€å¤§å€¼${maxTotalAllowed}ï¼ˆç¡®ä¿ROIâ‰¤150%ä¸”å›æŠ¥å‘¨æœŸâ‰¥6ä¸ªæœˆï¼‰`)
      }
      
      const total = finalTotal
      
      // ========== è®¡ç®—æœ€ç»ˆROIå’Œå›æŠ¥å‘¨æœŸ ==========
      let finalRoiValue = total > 0 ? (total / totalInvestment) * 100 : 0
      let finalPaybackMonths = total > 0 ? (totalInvestment / total) * 12 : 999
      
      // åŒé‡ä¿é™©ï¼šå¦‚æœè®¡ç®—å‡ºçš„å€¼ä»ç„¶è¶…å‡ºèŒƒå›´ï¼Œå†æ¬¡è°ƒæ•´æ”¶ç›Š
      // æ³¨æ„ï¼šéœ€è¦åŒæ—¶æ»¡è¶³ROIå’Œå›æŠ¥å‘¨æœŸä¸¤ä¸ªé™åˆ¶
      let finalTotalAdjusted = total
      let needsFinalAdjustment = false
      
      // æ£€æŸ¥å¹¶è°ƒæ•´ROI
      if(finalRoiValue < 40) {
        finalTotalAdjusted = Math.round(totalInvestment * 0.40)
        needsFinalAdjustment = true
        console.log('ROIè¿‡ä½ï¼Œå·²è°ƒæ•´æ”¶ç›Šä½¿ROI=40%')
      } else if(finalRoiValue > 150) {
        finalTotalAdjusted = Math.round(totalInvestment * 1.50)
        needsFinalAdjustment = true
        console.log('ROIè¿‡é«˜ï¼Œå·²è°ƒæ•´æ”¶ç›Šä½¿ROI=150%')
      }
      
      // æ£€æŸ¥å¹¶è°ƒæ•´å›æŠ¥å‘¨æœŸï¼ˆéœ€è¦åŒæ—¶è€ƒè™‘ROIé™åˆ¶ï¼‰
      if(finalPaybackMonths < 6) {
        // å›æŠ¥å‘¨æœŸ<6ä¸ªæœˆï¼Œéœ€è¦é™ä½æ”¶ç›Š
        // ä½†ä¹Ÿè¦è€ƒè™‘ROIä¸èƒ½è¶…è¿‡150%
        const paybackBasedTotal = Math.round(totalInvestment * (12 / 6))  // 6ä¸ªæœˆå¯¹åº”çš„æ”¶ç›Šï¼ˆROI=200%ï¼‰
        const roiBasedMaxTotal = Math.round(totalInvestment * 1.50)  // 150% ROIå¯¹åº”çš„æ”¶ç›Šï¼ˆå›æŠ¥å‘¨æœŸ=8ä¸ªæœˆï¼‰
        // å–è¾ƒå°å€¼ï¼Œç¡®ä¿åŒæ—¶æ»¡è¶³ä¸¤ä¸ªé™åˆ¶ï¼ˆ150% ROIæ˜¯æ›´ä¸¥æ ¼çš„é™åˆ¶ï¼‰
        const adjustedForPayback = Math.min(paybackBasedTotal, roiBasedMaxTotal)
        
        // å¦‚æœè¿™ä¸ªè°ƒæ•´æ¯”ä¹‹å‰çš„è°ƒæ•´æ›´ä¸¥æ ¼ï¼Œä½¿ç”¨å®ƒ
        if(adjustedForPayback < finalTotalAdjusted) {
          finalTotalAdjusted = adjustedForPayback
          needsFinalAdjustment = true
        }
        console.log('å›æŠ¥å‘¨æœŸè¿‡çŸ­ï¼Œå·²è°ƒæ•´æ”¶ç›Šä½¿å›æŠ¥å‘¨æœŸâ‰¥6ä¸ªæœˆä¸”ROIâ‰¤150%')
      } else if(finalPaybackMonths > 36) {
        // å›æŠ¥å‘¨æœŸ>36ä¸ªæœˆï¼Œéœ€è¦æé«˜æ”¶ç›Š
        // ä½†ä¹Ÿè¦è€ƒè™‘ROIä¸èƒ½ä½äº40%
        const paybackBasedTotal = Math.round(totalInvestment * (12 / 36))  // 36ä¸ªæœˆå¯¹åº”çš„æ”¶ç›Šï¼ˆROI=33.3%ï¼‰
        const roiBasedMinTotal = Math.round(totalInvestment * 0.40)  // 40% ROIå¯¹åº”çš„æ”¶ç›Šï¼ˆå›æŠ¥å‘¨æœŸ=30ä¸ªæœˆï¼‰
        // å–è¾ƒå¤§å€¼ï¼Œç¡®ä¿åŒæ—¶æ»¡è¶³ä¸¤ä¸ªé™åˆ¶ï¼ˆ40% ROIæ˜¯æ›´ä¸¥æ ¼çš„é™åˆ¶ï¼‰
        const adjustedForPayback = Math.max(paybackBasedTotal, roiBasedMinTotal)
        
        // å¦‚æœè¿™ä¸ªè°ƒæ•´æ¯”ä¹‹å‰çš„è°ƒæ•´æ›´ä¸¥æ ¼ï¼Œä½¿ç”¨å®ƒ
        if(adjustedForPayback > finalTotalAdjusted) {
          finalTotalAdjusted = adjustedForPayback
          needsFinalAdjustment = true
        }
        console.log('å›æŠ¥å‘¨æœŸè¿‡é•¿ï¼Œå·²è°ƒæ•´æ”¶ç›Šä½¿å›æŠ¥å‘¨æœŸâ‰¤36ä¸ªæœˆä¸”ROIâ‰¥40%')
      }
      
      // å¦‚æœè¿›è¡Œäº†æœ€ç»ˆè°ƒæ•´ï¼Œæ›´æ–°totalå’Œé‡æ–°è®¡ç®—
      if(needsFinalAdjustment) {
        total = finalTotalAdjusted
        finalRoiValue = total > 0 ? (total / totalInvestment) * 100 : 0
        finalPaybackMonths = total > 0 ? (totalInvestment / total) * 12 : 999
        
        // æœ€ç»ˆéªŒè¯ï¼ˆé˜²æ­¢è®¡ç®—è¯¯å·®ï¼‰
        if(finalRoiValue < 40) finalRoiValue = 40
        if(finalRoiValue > 150) finalRoiValue = 150
        if(finalPaybackMonths < 6) finalPaybackMonths = 6
        if(finalPaybackMonths > 36) finalPaybackMonths = 36
      }
      
      // ========== è®¡ç®—æŠ•èµ„å›æŠ¥å‘¨æœŸï¼ˆæ ¼å¼åŒ–æ˜¾ç¤ºï¼‰ ==========
      let payback = 'â€”'
      let paybackYears = 0
      let paybackMonths = 0
      
      if(total > 0) {
        // ä½¿ç”¨æœ€ç»ˆéªŒè¯åçš„å›æŠ¥å‘¨æœŸ
        paybackYears = Math.floor(finalPaybackMonths / 12)  // å¹´æ•°
        paybackMonths = Math.round(finalPaybackMonths % 12)  // æœˆæ•°ï¼ˆå››èˆäº”å…¥ï¼‰
        
        // å¦‚æœæœˆæ•°æ¥è¿‘12ï¼Œå‘ä¸Šè¿›ä½åˆ°å¹´
        if(paybackMonths >= 11.5) {
          paybackYears += 1
          paybackMonths = 0
        }
        
        // æ ¼å¼åŒ–æ˜¾ç¤º
        if(paybackYears > 0 && paybackMonths > 0) {
          payback = `${paybackYears}å¹´${paybackMonths}ä¸ªæœˆ`
        } else if(paybackYears > 0) {
          payback = `${paybackYears}å¹´`
        } else if(paybackMonths > 0) {
          payback = `${paybackMonths}ä¸ªæœˆ`
        } else {
          payback = '6ä¸ªæœˆ'  // æœ€å°å€¼
        }
      }
      
      // ========== è®¡ç®—å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡ (ROI) ==========
      const roi = finalRoiValue.toFixed(1)
      
      // æœ€ç»ˆéªŒè¯æ—¥å¿—
      console.log(`æœ€ç»ˆç»“æœ - ROI: ${roi}%, å›æŠ¥å‘¨æœŸ: ${paybackMonths > 0 ? paybackMonths + 'ä¸ªæœˆ' : paybackYears + 'å¹´'}`)

      // å¡«å……ç”Ÿäº§æƒ…å†µæ¦‚è§ˆ
      const reportIndustryEl = document.getElementById('reportIndustry')
      if(reportIndustryEl) reportIndustryEl.textContent = industry
      const materialNameForDisplay = material.includes('ï¼š') ? material.split('ï¼š')[0] : material
      const reportMaterialEl = document.getElementById('reportMaterial')
      if(reportMaterialEl) reportMaterialEl.textContent = materialNameForDisplay
      const reportThicknessEl = document.getElementById('reportThickness')
      if(reportThicknessEl) reportThicknessEl.textContent = (parseFloat(state.thicknessMax) || 3.0).toFixed(1) + ' mm'
      const reportWidthEl = document.getElementById('reportWidth')
      if(reportWidthEl) reportWidthEl.textContent = (parseInt(state.maxWidth) || 1500) + ' mm'
      const reportTonsEl = document.getElementById('reportTons')
      if(reportTonsEl) reportTonsEl.textContent = (parseFloat(state.annualTons) || 10000).toLocaleString('zh-CN') + ' å¨'
      
      // æ˜¾ç¤ºç—›ç‚¹ï¼ˆä½¿ç”¨ä¹‹å‰å£°æ˜çš„painså’ŒotherPainå˜é‡ï¼‰
      let painsText = ''
      if(pains.length > 0) {
        painsText = 'ä¸»è¦ç—›ç‚¹ï¼š' + pains.join('ã€')
        if(otherPain) {
          painsText += 'ã€' + otherPain
        }
      } else if(otherPain) {
        painsText = 'ä¸»è¦ç—›ç‚¹ï¼š' + otherPain
      }
      const reportPainsEl = document.getElementById('reportPains')
      if(reportPainsEl) reportPainsEl.textContent = painsText || 'æœªå¡«å†™ç—›ç‚¹'

      // å¡«å……è®¾å¤‡ä¿¡æ¯
      const reportSeriesNameEl = document.getElementById('reportSeriesName')
      if(reportSeriesNameEl) reportSeriesNameEl.textContent = recSeries.name
      const reportPriceEl = document.getElementById('reportPrice')
      if(reportPriceEl) reportPriceEl.textContent = money(dynamicPrice)
      const reportCapEl = document.getElementById('reportCap')
      if(reportCapEl) reportCapEl.textContent = recSeries.cap
      
      // å¡«å……æŠ•å…¥æ˜ç»†
      const reportInvestmentDeviceEl = document.getElementById('reportInvestmentDevice')
      if(reportInvestmentDeviceEl) reportInvestmentDeviceEl.textContent = money(investmentDevice)
      const reportInvestmentInstallEl = document.getElementById('reportInvestmentInstall')
      if(reportInvestmentInstallEl) reportInvestmentInstallEl.textContent = money(investmentInstall)
      const reportInvestmentAuxEl = document.getElementById('reportInvestmentAux')
      if(reportInvestmentAuxEl) reportInvestmentAuxEl.textContent = money(investmentAux)
      const reportInvestmentTrainingEl = document.getElementById('reportInvestmentTraining')
      if(reportInvestmentTrainingEl) reportInvestmentTrainingEl.textContent = money(investmentTraining)
      const reportInvestmentMaintenanceEl = document.getElementById('reportInvestmentMaintenance')
      if(reportInvestmentMaintenanceEl) reportInvestmentMaintenanceEl.textContent = money(investmentMaintenance)
      const reportTotalInvestmentEl = document.getElementById('reportTotalInvestment')
      if(reportTotalInvestmentEl) reportTotalInvestmentEl.textContent = money(totalInvestment)
      
      // å¡«å……æ”¶ç›Šæ•°æ®ï¼ˆå››é¡¹æ”¶ç›Šå¡ç‰‡å·²åˆ é™¤ï¼Œä¸å†éœ€è¦å¡«å……ï¼‰
      // document.getElementById('reportS1').textContent = money(s1)
      // document.getElementById('reportS2').textContent = money(s2)
      // document.getElementById('reportS3').textContent = money(s3)
      // document.getElementById('reportS4').textContent = money(s4)
      
      // å¡«å……æ€»æ”¶ç›Š
      const reportTotalReturnsEl = document.getElementById('reportTotalReturns')
      if(reportTotalReturnsEl) reportTotalReturnsEl.textContent = money(total)
      const reportTotalSavingEl = document.getElementById('reportTotalSaving')
      if(reportTotalSavingEl) reportTotalSavingEl.textContent = money(total)
      
      // è®¡ç®—å¹¶å¡«å……å…³é”®æŒ‡æ ‡ç™¾åˆ†æ¯”ï¼ˆä½¿ç”¨ä¸Šé¢å·²å£°æ˜çš„å˜é‡ï¼‰
      // 1. è‰¯å“ç‡æå‡ç™¾åˆ†æ¯” = (æ–°åˆæ ¼ç‡ - åŸåˆæ ¼ç‡) / åŸåˆæ ¼ç‡ Ã— 100%
      const qualityRateImprove = s2_oldRate > 0 ? ((s2_newRate - s2_oldRate) / s2_oldRate * 100).toFixed(1) : '0.0'
      const reportQualityRateEl = document.getElementById('reportQualityRate')
      if(reportQualityRateEl) reportQualityRateEl.textContent = '+' + qualityRateImprove + '%'
      
      // 2. äººå·¥èŠ‚çœç™¾åˆ†æ¯” = (åŸæ“ä½œäººæ•° - æ–°æ“ä½œäººæ•°) / åŸæ“ä½œäººæ•° Ã— 100%
      const laborSaveRate = s3_oldWorkers > 0 ? ((s3_oldWorkers - s3_newWorkers) / s3_oldWorkers * 100).toFixed(1) : '0.0'
      const reportLaborSaveEl = document.getElementById('reportLaborSave')
      if(reportLaborSaveEl) reportLaborSaveEl.textContent = '-' + laborSaveRate + '%'
      
      // 3. æ•ˆç‡æå‡ç™¾åˆ†æ¯” = (æ–°è®¾å¤‡äº§èƒ½ - åŸè®¾å¤‡äº§èƒ½) / åŸè®¾å¤‡äº§èƒ½ Ã— 100%
      const efficiencyImprove = s1_oldCapacityHourly > 0 ? ((s1_newCapacity - s1_oldCapacityHourly) / s1_oldCapacityHourly * 100).toFixed(1) : '0.0'
      const reportEfficiencyEl = document.getElementById('reportEfficiency')
      if(reportEfficiencyEl) reportEfficiencyEl.textContent = '+' + efficiencyImprove + '%'
      
      // 4. èƒ½è€—é™ä½ç™¾åˆ†æ¯” = èŠ‚èƒ½æ¯”ä¾‹ï¼ˆèƒ½è€—é¡¹å§‹ç»ˆæ˜¾ç¤ºï¼‰
      const energySaveRate = s4_energySaveRate.toFixed(1)
      const reportEnergySaveEl = document.getElementById('reportEnergySave')
      if(reportEnergySaveEl) reportEnergySaveEl.textContent = '-' + energySaveRate + '%'
      
      const reportPaybackEl = document.getElementById('reportPayback')
      if(reportPaybackEl) reportPaybackEl.textContent = payback
      const reportROIEl = document.getElementById('reportROI')
      if(reportROIEl) reportROIEl.textContent = roi + '%'

      // ç»“è®ºå»ºè®®ï¼ˆåŸºäºæŠ•èµ„å›æŠ¥å‘¨æœŸï¼ŒROIèŒƒå›´40%-150%ï¼Œå›æŠ¥å‘¨æœŸ6ä¸ªæœˆ~3å¹´ï¼‰
      const conclusion = document.getElementById('reportAdvice')
      if(!conclusion) {
        console.error('reportAdvice å…ƒç´ æœªæ‰¾åˆ°')
        return
      }
      const roiValueForConclusion = parseFloat(roi)
      const totalMonths = paybackYears * 12 + paybackMonths
      
      if(total<=0) {
        conclusion.style.background = 'var(--red-bg)'
        conclusion.style.color = 'var(--red-text)'
        conclusion.textContent = 'é¢„çº¦å·¥è‰ºè¯„ä¼°ï¼šæˆ‘ä»¬çš„å·¥ç¨‹å¸ˆå¯ä¸Šé—¨åˆ†æä¼˜åŒ–ç©ºé—´ï¼Œæä¾›æ›´ç²¾å‡†çš„ROIæµ‹ç®—ã€‚'
      } else if(totalMonths <= 12) {
        // 6-12ä¸ªæœˆï¼ˆå¿«é€Ÿå›æœ¬ï¼ŒROIé€šå¸¸è¾ƒé«˜ï¼Œ100%-150%ï¼‰
        conclusion.style.background = 'var(--green-bg)'
        conclusion.style.color = 'var(--green-text)'
        conclusion.textContent = 'âœ… å¼ºçƒˆæ¨èï¼šå¿«é€Ÿå›æœ¬ï¼ˆ6-12ä¸ªæœˆï¼‰ï¼Œè¿™æ˜¯åˆ¶é€ ä¸šå‡çº§ä¸­ROIæœ€é«˜çš„å•æœºè®¾å¤‡ä¹‹ä¸€ï¼è®¾å¤‡å¯¿å‘½10å¹´ä»¥ä¸Šï¼Œåç»­å‡ä¸ºçº¯æ”¶ç›Šã€‚'
      } else if(totalMonths <= 24) {
        // 12-24ä¸ªæœˆï¼ˆ1-2å¹´ï¼ŒROIé€šå¸¸50%-100%ï¼‰
        conclusion.style.background = 'var(--green-bg)'
        conclusion.style.color = 'var(--green-text)'
        conclusion.textContent = 'âœ… å€¼å¾—æŠ•å…¥ï¼šæŠ•èµ„å›æŠ¥å‘¨æœŸ1-2å¹´ï¼Œç¬¦åˆè¡Œä¸šå…¸å‹æ°´å¹³ã€‚æ˜¾è‘—æå‡äº¤ä»˜ä¸€è‡´æ€§ï¼Œå¢å¼ºå®¢æˆ·ä¿¡ä»»ã€‚é•¿æœŸæ”¶ç›Šå¯è§‚ã€‚'
      } else if(totalMonths <= 36) {
        // 24-36ä¸ªæœˆï¼ˆ2-3å¹´ï¼ŒROIé€šå¸¸40%-60%ï¼‰
        conclusion.style.background = 'var(--yellow-bg)'
        conclusion.style.color = 'var(--yellow-text)'
        conclusion.textContent = 'âš ï¸ å»ºè®®æ‰“æ ·éªŒè¯ï¼šæŠ•èµ„å›æŠ¥å‘¨æœŸ2-3å¹´ï¼Œç¬¦åˆé‡å‹è®¾å¤‡è¡Œä¸šæ°´å¹³ã€‚å»ºè®®å…ˆå…è´¹æµ‹è¯•æ•ˆæœï¼ŒéªŒè¯å®é™…æ”¹å–„åå†å†³å®šé‡‡è´­ã€‚'
      } else {
        // >36ä¸ªæœˆï¼ˆè¶…å‡ºåˆç†èŒƒå›´ï¼Œç†è®ºä¸Šä¸åº”è¯¥å‡ºç°ï¼Œå› ä¸ºå·²é™åˆ¶åœ¨36ä¸ªæœˆå†…ï¼‰
        conclusion.style.background = 'var(--blue-bg)'
        conclusion.style.color = 'var(--blue-text)'
        conclusion.textContent = 'ğŸ” é¢„çº¦å·¥è‰ºè¯„ä¼°ï¼šæŠ•èµ„å›æŠ¥å‘¨æœŸè¾ƒé•¿ï¼Œæˆ‘ä»¬çš„å·¥ç¨‹å¸ˆå¯ä¸Šé—¨åˆ†æä¼˜åŒ–ç©ºé—´ï¼Œæä¾›å®šåˆ¶åŒ–æ–¹æ¡ˆã€‚'
      }
      console.log('æŠ¥å‘Šç”Ÿæˆå®Œæˆ')
      } catch(err) {
        console.error('generateReport é”™è¯¯:', err)
        alert('ç”ŸæˆæŠ¥å‘Šæ—¶å‘ç”Ÿé”™è¯¯ï¼š' + err.message)
        throw err  // é‡æ–°æŠ›å‡ºé”™è¯¯ï¼Œè®©è°ƒç”¨è€…çŸ¥é“
      }
    }

    // æ”¶é›†æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„æ•°æ®
    function collectAllUserData() {
      const data = {
        // Step 1: ææ–™ä¸ç”Ÿäº§æƒ…å†µ
        step1: {
          æ‰€å±è¡Œä¸š: state.industry || 'æœªå¡«å†™',
          ä¸»è¦åŠ å·¥ææ–™: state.material || 'æœªå¡«å†™',
          æœ€å¤§åšåº¦: (parseFloat(state.thicknessMax) || 0).toFixed(1) + ' mm',
          æœ€å¤§æ¿å®½: (parseInt(state.maxWidth) || 0) + ' mm',
          å¹´åŠ å·¥é‡: (parseFloat(state.annualTons) || 0).toLocaleString('zh-CN') + ' å¨',
          ä¸»è¦ç—›ç‚¹: state.pains && state.pains.length > 0 ? state.pains.join('ã€') : 'æœªå¡«å†™',
          å…¶ä»–ç—›ç‚¹: state.otherPain || 'æ— '
        },
        
        // Step 2: é€‰æ‹©çš„è®¾å¤‡ç³»åˆ—
        step2: {
          æ¨èç³»åˆ—: state.recommendedKey || 'æœªæ¨è',
          é€‰æ‹©ç³»åˆ—: state.selectedSeriesKey || state.recommendedKey || 'æœªé€‰æ‹©',
          è®¾å¤‡åç§°: (() => {
            const selectedKey = state.selectedSeriesKey || state.recommendedKey
            const series = seriesList.find(s => s.key === selectedKey)
            return series ? series.name : 'æœªé€‰æ‹©'
          })()
        },
        
        // Step 3: ROIè¾“å…¥æ•°æ®
        step3: {
          åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡: document.getElementById('s1_oldCapacity') ? parseFloat(document.getElementById('s1_oldCapacity').value || 0).toFixed(2) + ' å¨' : 'æœªå¡«å†™',
          æ–°è®¾å¤‡æ¯å°æ—¶å¤„ç†é‡: document.getElementById('s1_newCapacity') ? parseFloat(document.getElementById('s1_newCapacity').value || 0).toFixed(2) + ' å¨/å°æ—¶' : 'æœªå¡«å†™',
          å•ä½äº§å“åˆ©æ¶¦: document.getElementById('s1_profitPerTon') ? 'Â¥' + parseFloat(document.getElementById('s1_profitPerTon').value || 0).toFixed(2) + '/å¨' : 'æœªå¡«å†™',
          åŸåˆæ ¼ç‡: document.getElementById('s2_oldRate') ? parseFloat(document.getElementById('s2_oldRate').value || 0).toFixed(1) + '%' : 'æœªå¡«å†™',
          æ–°åˆæ ¼ç‡: document.getElementById('s2_newRate') ? parseFloat(document.getElementById('s2_newRate').value || 0).toFixed(1) + '%' : 'æœªå¡«å†™',
          å¹´ææ–™æˆæœ¬: document.getElementById('s2_materialCost') ? 'Â¥' + parseInt(document.getElementById('s2_materialCost').value || 0).toLocaleString('zh-CN') : 'æœªå¡«å†™',
          åŸæ“ä½œäººæ•°: document.getElementById('s3_oldWorkers') ? parseInt(document.getElementById('s3_oldWorkers').value || 0) + ' äºº' : 'æœªå¡«å†™',
          æ–°è®¾å¤‡æ“ä½œäººæ•°: '1 äººï¼ˆç³»ç»Ÿé»˜è®¤ï¼‰',
          é¢„ä¼°äººå‡å¹´æˆæœ¬: document.getElementById('s3_costPerWorker') ? 'Â¥' + parseInt(document.getElementById('s3_costPerWorker').value || 0).toLocaleString('zh-CN') : 'æœªå¡«å†™',
          å¹´ç”µè´¹: document.getElementById('s4_energyCost') ? 'Â¥' + parseInt(document.getElementById('s4_energyCost').value || 0).toLocaleString('zh-CN') : 'æœªå¡«å†™',
          èŠ‚èƒ½æ¯”ä¾‹: document.getElementById('s4_energySaveRate') ? parseFloat(document.getElementById('s4_energySaveRate').value || 0).toFixed(1) + '%' : 'æœªå¡«å†™'
        },
        
        // Step 4: è®¡ç®—ç»“æœï¼ˆå¦‚æœå·²ç”ŸæˆæŠ¥å‘Šï¼‰
        step4: (() => {
          const step4 = document.getElementById('step4')
          if(step4 && step4.style.display !== 'none') {
            return {
              å¹´å‡€æ”¶ç›Š: document.getElementById('reportTotalSaving') ? document.getElementById('reportTotalSaving').textContent : 'æœªè®¡ç®—',
              æŠ•èµ„å›æŠ¥å‘¨æœŸ: document.getElementById('reportPayback') ? document.getElementById('reportPayback').textContent : 'æœªè®¡ç®—',
              å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡: document.getElementById('reportROI') ? document.getElementById('reportROI').textContent : 'æœªè®¡ç®—',
              æ€»æŠ•å…¥: document.getElementById('reportTotalInvestment') ? document.getElementById('reportTotalInvestment').textContent : 'æœªè®¡ç®—'
            }
          }
          return null
        })(),
        
        // ç•™èµ„è¡¨å•æ•°æ®
        leadForm: {
          å§“å: document.getElementById('leadName') ? document.getElementById('leadName').value.trim() : 'æœªå¡«å†™',
          ç”µè¯: document.getElementById('leadPhone') ? document.getElementById('leadPhone').value.trim() : 'æœªå¡«å†™',
          è¡Œä¸š: document.getElementById('leadIndustry') ? document.getElementById('leadIndustry').value : 'æœªå¡«å†™',
          å¤‡æ³¨: document.getElementById('leadRemark') ? document.getElementById('leadRemark').value.trim() : 'æ— '
        }
      }
      
      return data
    }
    
    // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
    function showDataPreview() {
      const data = collectAllUserData()
      const modal = document.getElementById('dataPreviewModal')
      const content = document.getElementById('dataPreviewContent')
      
      if(!modal || !content) {
        console.error('æ•°æ®é¢„è§ˆå¼¹çª—å…ƒç´ æœªæ‰¾åˆ°')
        return
      }
      
      // ç”ŸæˆHTMLå†…å®¹
      let html = ''
      
      // Step 1æ•°æ®
      html += '<div style="margin-bottom:16px; padding:16px; background:#F9FAFB; border-radius:8px;">'
      html += '<h3 style="margin:0 0 12px; font-size:16px; color:#1E3A8A;">ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šææ–™ä¸ç”Ÿäº§æƒ…å†µ</h3>'
      html += '<div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:8px; font-size:14px;">'
      html += `<div><strong>æ‰€å±è¡Œä¸šï¼š</strong><br/>${data.step1.æ‰€å±è¡Œä¸š}</div>`
      html += `<div><strong>ä¸»è¦ææ–™ï¼š</strong><br/>${data.step1.ä¸»è¦åŠ å·¥ææ–™}</div>`
      html += `<div><strong>æœ€å¤§åšåº¦ï¼š</strong><br/>${data.step1.æœ€å¤§åšåº¦}</div>`
      html += `<div><strong>æœ€å¤§æ¿å®½ï¼š</strong><br/>${data.step1.æœ€å¤§æ¿å®½}</div>`
      html += `<div><strong>å¹´åŠ å·¥é‡ï¼š</strong><br/>${data.step1.å¹´åŠ å·¥é‡}</div>`
      html += `<div style="grid-column:1/-1; margin-top:8px;"><strong>ä¸»è¦ç—›ç‚¹ï¼š</strong>${data.step1.ä¸»è¦ç—›ç‚¹}</div>`
      if(data.step1.å…¶ä»–ç—›ç‚¹ !== 'æ— ') {
        html += `<div style="grid-column:1/-1;"><strong>å…¶ä»–ç—›ç‚¹ï¼š</strong>${data.step1.å…¶ä»–ç—›ç‚¹}</div>`
      }
      html += '</div></div>'
      
      // Step 2æ•°æ®
      html += '<div style="margin-bottom:20px; padding:16px; background:#F9FAFB; border-radius:8px;">'
      html += '<h3 style="margin:0 0 12px; font-size:16px; color:#1E3A8A;">âš™ï¸ ç¬¬äºŒæ­¥ï¼šé€‰æ‹©çš„è®¾å¤‡ç³»åˆ—</h3>'
      html += '<div style="font-size:14px; line-height:1.8;">'
      html += `<div><strong>é€‰æ‹©ç³»åˆ—ï¼š</strong>${data.step2.è®¾å¤‡åç§°}</div>`
      html += `<div><strong>æ¨èç³»åˆ—ï¼š</strong>${data.step2.æ¨èç³»åˆ—}</div>`
      html += '</div></div>'
      
      // Step 3æ•°æ®
      html += '<div style="margin-bottom:16px; padding:16px; background:#F9FAFB; border-radius:8px;">'
      html += '<h3 style="margin:0 0 12px; font-size:16px; color:#1E3A8A;">ğŸ’° ç¬¬ä¸‰æ­¥ï¼šROIè¾“å…¥æ•°æ®</h3>'
      html += '<div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(160px, 1fr)); gap:8px; font-size:14px;">'
      html += `<div><strong>åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡ï¼š</strong><br/>${data.step3.åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡}</div>`
      html += `<div><strong>æ–°è®¾å¤‡æ¯å°æ—¶å¤„ç†é‡ï¼š</strong><br/>${data.step3.æ–°è®¾å¤‡æ¯å°æ—¶å¤„ç†é‡}</div>`
      html += `<div><strong>å•ä½äº§å“åˆ©æ¶¦ï¼š</strong><br/>${data.step3.å•ä½äº§å“åˆ©æ¶¦}</div>`
      html += `<div><strong>åŸåˆæ ¼ç‡ï¼š</strong><br/>${data.step3.åŸåˆæ ¼ç‡}</div>`
      html += `<div><strong>æ–°åˆæ ¼ç‡ï¼š</strong><br/>${data.step3.æ–°åˆæ ¼ç‡}</div>`
      html += `<div><strong>å¹´ææ–™æˆæœ¬ï¼š</strong><br/>${data.step3.å¹´ææ–™æˆæœ¬}</div>`
      html += `<div><strong>åŸæ“ä½œäººæ•°ï¼š</strong><br/>${data.step3.åŸæ“ä½œäººæ•°}</div>`
      html += `<div><strong>æ–°è®¾å¤‡æ“ä½œäººæ•°ï¼š</strong><br/>${data.step3.æ–°è®¾å¤‡æ“ä½œäººæ•°}</div>`
      html += `<div><strong>é¢„ä¼°äººå‡å¹´æˆæœ¬ï¼š</strong><br/>${data.step3.é¢„ä¼°äººå‡å¹´æˆæœ¬}</div>`
      html += `<div><strong>å¹´ç”µè´¹ï¼š</strong><br/>${data.step3.å¹´ç”µè´¹}</div>`
      html += `<div><strong>èŠ‚èƒ½æ¯”ä¾‹ï¼š</strong><br/>${data.step3.èŠ‚èƒ½æ¯”ä¾‹}</div>`
      html += '</div></div>'
      
      // Step 4æ•°æ®ï¼ˆå¦‚æœå·²ç”Ÿæˆï¼‰
      if(data.step4) {
        html += '<div style="margin-bottom:16px; padding:16px; background:#E0F2FE; border-radius:8px; border-left:4px solid #1E3A8A;">'
        html += '<h3 style="margin:0 0 12px; font-size:16px; color:#1E3A8A;">ğŸ“Š ç¬¬å››æ­¥ï¼šROIè®¡ç®—ç»“æœ</h3>'
        html += '<div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:8px; font-size:14px;">'
        html += `<div><strong>å¹´å‡€æ”¶ç›Šï¼š</strong><br/>${data.step4.å¹´å‡€æ”¶ç›Š}</div>`
        html += `<div><strong>æŠ•èµ„å›æŠ¥å‘¨æœŸï¼š</strong><br/>${data.step4.æŠ•èµ„å›æŠ¥å‘¨æœŸ}</div>`
        html += `<div><strong>å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡ï¼š</strong><br/>${data.step4.å¹´åŒ–æŠ•èµ„å›æŠ¥ç‡}</div>`
        html += `<div><strong>æ€»æŠ•å…¥ï¼š</strong><br/>${data.step4.æ€»æŠ•å…¥}</div>`
        html += '</div></div>'
      }
      
      // ç•™èµ„è¡¨å•æ•°æ®
      html += '<div style="margin-bottom:20px; padding:16px; background:#F9FAFB; border-radius:8px;">'
      html += '<h3 style="margin:0 0 12px; font-size:16px; color:#1E3A8A;">ğŸ“ ç•™èµ„ä¿¡æ¯</h3>'
      html += '<div style="font-size:14px; line-height:1.8;">'
      html += `<div><strong>å§“åï¼š</strong>${data.leadForm.å§“å}</div>`
      html += `<div><strong>ç”µè¯ï¼š</strong>${data.leadForm.ç”µè¯}</div>`
      html += `<div><strong>è¡Œä¸šï¼š</strong>${data.leadForm.è¡Œä¸š}</div>`
      html += `<div><strong>å¤‡æ³¨ï¼š</strong>${data.leadForm.å¤‡æ³¨}</div>`
      html += '</div></div>'
      
      // JSONæ ¼å¼æ•°æ®ï¼ˆä¾›å¼€å‘è€…æŸ¥çœ‹ï¼‰
      html += '<div style="margin-bottom:16px; padding:16px; background:#1F2937; border-radius:8px; color:#F9FAFB;">'
      html += '<h3 style="margin:0 0 12px; font-size:16px; color:#F9FAFB;">ğŸ”§ JSONæ ¼å¼ï¼ˆå¼€å‘è€…ï¼‰</h3>'
      html += `<pre style="margin:0; font-size:11px; overflow-x:auto; white-space:pre-wrap; word-wrap:break-word; max-height:300px; overflow-y:auto;">${JSON.stringify(data, null, 2)}</pre>`
      html += '</div>'
      
      content.innerHTML = html
      modal.style.display = 'block'
    }
    
    // å…³é—­æ•°æ®é¢„è§ˆ
    function closeDataPreview() {
      const modal = document.getElementById('dataPreviewModal')
      if(modal) {
        modal.style.display = 'none'
      }
    }
    
    // å¤åˆ¶æ•°æ®åˆ°å‰ªè´´æ¿
    function copyDataToClipboard() {
      const data = collectAllUserData()
      const dataText = JSON.stringify(data, null, 2)
      
      if(navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(dataText).then(() => {
          alert('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')
        }).catch(err => {
          console.error('å¤åˆ¶å¤±è´¥:', err)
          // å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
          const textarea = document.createElement('textarea')
          textarea.value = dataText
          document.body.appendChild(textarea)
          textarea.select()
          document.execCommand('copy')
          document.body.removeChild(textarea)
          alert('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')
        })
      } else {
        // å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
        const textarea = document.createElement('textarea')
        textarea.value = dataText
        document.body.appendChild(textarea)
        textarea.select()
        document.execCommand('copy')
        document.body.removeChild(textarea)
        alert('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')
      }
    }

    // ç»‘å®š"è®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘Š"æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¯é‡å¤è°ƒç”¨ï¼‰
    function bindCalculateReportButton() {
      const calculateReportBtn = document.getElementById('calculateReportBtn')
      if(calculateReportBtn) {
        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        const newBtn = calculateReportBtn.cloneNode(true)
        if(calculateReportBtn.parentNode) {
          calculateReportBtn.parentNode.replaceChild(newBtn, calculateReportBtn)
        }
        
        // é‡æ–°ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        newBtn.addEventListener('click', function(e) {
          console.log('è®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®è¢«ç‚¹å‡»')
          e.preventDefault()
          e.stopPropagation()
          e.stopImmediatePropagation()
          
          try {
            const result = showStep4()
            if(!result) {
              console.warn('showStep4è¿”å›falseï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜')
            }
          } catch(err) {
            console.error('è®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®ç‚¹å‡»é”™è¯¯:', err)
            alert('å‘ç”Ÿé”™è¯¯ï¼š' + err.message)
          }
          return false
        })
        
        // ä¹Ÿç»‘å®šonclickä½œä¸ºå¤‡é€‰
        newBtn.onclick = function(e) {
          e.preventDefault()
          e.stopPropagation()
          showStep4()
          return false
        }
        
        console.log('è®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š')
        return true
      } else {
        console.warn('è®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®æœªæ‰¾åˆ°')
        return false
      }
    }

    // è¿”å›Step 1çš„å‡½æ•°
    function backToStep1() {
      console.log('è¿”å›Step 1')
      const step1 = document.getElementById('step1')
      const step2 = document.getElementById('step2')
      
      if(step2) {
        step2.style.display = 'none'
      }
      
      if(step1) {
        step1.style.display = 'block'
        step1.scrollIntoView({ behavior: 'smooth', block: 'start' })
      }
    }
    
    // è¿”å›Step 2çš„å‡½æ•°ï¼ˆéšè—ROIè¾“å…¥åŒºåŸŸï¼‰
    function backToStep2() {
      console.log('è¿”å›Step 2')
      const step2 = document.getElementById('step2')
      const roiInputSection = document.getElementById('roiInputSection')
      
      if(roiInputSection) {
        roiInputSection.style.display = 'none'
      }
      
      if(step2) {
        step2.style.display = 'block'
        step2.scrollIntoView({ behavior: 'smooth', block: 'start' })
      }
    }
    
    // è¿”å›ROIè¾“å…¥åŒºåŸŸçš„å‡½æ•°
    function backToROIInput() {
      console.log('è¿”å›ROIè¾“å…¥åŒºåŸŸ')
      const step2 = document.getElementById('step2')
      const roiInputSection = document.getElementById('roiInputSection')
      const step4 = document.getElementById('step4')
      
      if(step4) {
        step4.style.display = 'none'
      }
      
      if(step2) {
        step2.style.display = 'block'
      }
      
      if(roiInputSection) {
        roiInputSection.style.display = 'block'
        setTimeout(() => {
          roiInputSection.scrollIntoView({ behavior: 'smooth', block: 'start' })
        }, 100)
      }
    }

    function showStep4() {
      console.log('showStep4 è¢«è°ƒç”¨')
      try {
        // å…ˆæ£€æŸ¥step4æ˜¯å¦å­˜åœ¨
        const step4 = document.getElementById('step4')
        if(!step4) {
          console.error('step4 æœªæ‰¾åˆ°')
          alert('é”™è¯¯ï¼šæ‰¾ä¸åˆ°æŠ¥å‘Šé¡µé¢ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')
          return false
        }
        
        // å…ˆéšè—å‰é¢çš„æ­¥éª¤
        const step2 = document.getElementById('step2')
        if(step2) {
          step2.style.display = 'none'
          console.log('step2 å·²éšè—')
        }
        
        const roiInputSection = document.getElementById('roiInputSection')
        if(roiInputSection) {
          roiInputSection.style.display = 'none'
          console.log('roiInputSection å·²éšè—')
        }
        
        // ç”ŸæˆæŠ¥å‘Šï¼ˆå³ä½¿å‡ºé”™ä¹Ÿè¦æ˜¾ç¤ºstep4ï¼‰
        try {
          generateReport()
          console.log('æŠ¥å‘Šç”ŸæˆæˆåŠŸ')
        } catch(reportErr) {
          console.error('generateReport é”™è¯¯:', reportErr)
          // å³ä½¿æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œä¹Ÿæ˜¾ç¤ºstep4ï¼Œè®©ç”¨æˆ·çœ‹åˆ°é”™è¯¯ä¿¡æ¯
          alert('ç”ŸæˆæŠ¥å‘Šæ—¶å‘ç”Ÿé”™è¯¯ï¼š' + reportErr.message + '\næŠ¥å‘Šé¡µé¢ä»ä¼šæ˜¾ç¤ºï¼Œä½†æ•°æ®å¯èƒ½ä¸å®Œæ•´ã€‚')
        }
        
        // æ˜¾ç¤ºæŠ¥å‘Šé¡µé¢
        step4.style.display = 'block'
        console.log('step4 å·²æ˜¾ç¤º')
        
        // ç¡®ä¿è¿”å›æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š
        const backToROIInputBtn = document.getElementById('backToROIInputBtn')
        if(backToROIInputBtn) {
          backToROIInputBtn.onclick = (e) => {
            e.preventDefault()
            backToROIInput()
          }
        }
        
        // å¼ºåˆ¶é‡æ’ï¼Œç¡®ä¿æ˜¾ç¤ºç”Ÿæ•ˆ
        step4.offsetHeight
        
        // æ»šåŠ¨åˆ°æŠ¥å‘Šé¡µé¢ï¼ˆä½¿ç”¨å¤šç§æ–¹æ³•ç¡®ä¿æˆåŠŸï¼‰
        setTimeout(() => {
          try {
            // æ–¹æ³•1ï¼šä½¿ç”¨scrollIntoView
            step4.scrollIntoView({ behavior: 'smooth', block: 'start' })
          } catch(scrollErr) {
            console.warn('scrollIntoViewå¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹æ³•:', scrollErr)
            try {
              // æ–¹æ³•2ï¼šä½¿ç”¨window.scrollTo
              const rect = step4.getBoundingClientRect()
              window.scrollTo({
                top: window.pageYOffset + rect.top - 20,
                behavior: 'smooth'
              })
            } catch(scrollErr2) {
              // æ–¹æ³•3ï¼šç›´æ¥è®¾ç½®scrollTop
              console.warn('window.scrollToå¤±è´¥ï¼Œä½¿ç”¨ç›´æ¥è®¾ç½®:', scrollErr2)
              window.scrollTo(0, step4.offsetTop - 20)
            }
          }
        }, 150)
        
        return true
      } catch(err) {
        console.error('showStep4 é”™è¯¯:', err)
        alert('å‘ç”Ÿé”™è¯¯ï¼š' + err.message + '\nè¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚')
        return false
      }
    }


    // åˆå§‹åŒ– - ç¡®ä¿DOMåŠ è½½åæ‰§è¡Œ
    function initEventListeners() {
      const industrySelect = document.getElementById('industry')
      if(industrySelect) {
        industrySelect.addEventListener('change', (e) => {
          state.industry = e.target.value
        })
      } else {
        console.error('è¡Œä¸šé€‰æ‹©å™¨æœªæ‰¾åˆ°')
      }

      const materialSelect = document.getElementById('material')
      const otherMaterialInput = document.getElementById('otherMaterialInput')
      const otherMaterialText = document.getElementById('otherMaterialText')
      
      if(materialSelect) {
        materialSelect.addEventListener('change', (e) => {
          state.material = e.target.value
          if(e.target.value === 'å…¶ä»–æè´¨') {
            if(otherMaterialInput) otherMaterialInput.classList.add('show')
          } else {
            if(otherMaterialInput) otherMaterialInput.classList.remove('show')
            state.otherMaterial = ''
            if(otherMaterialText) otherMaterialText.value = ''
          }
          // å¦‚æœå·²æ˜¾ç¤ºè®¾å¤‡æ¨èé¡µé¢ï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°ä»·æ ¼
          if(document.getElementById('step2') && document.getElementById('step2').style.display === 'block') {
            renderSeries()
          }
          
          // å¦‚æœå·²æ˜¾ç¤ºROIè¾“å…¥é¡µé¢ï¼Œæ›´æ–°å¹´ææ–™æˆæœ¬
          const roiInputSection = document.getElementById('roiInputSection')
          if(roiInputSection && roiInputSection.style.display !== 'none') {
            const s2MaterialCost = document.getElementById('s2_materialCost')
            if(s2MaterialCost && !s2MaterialCost.hasAttribute('data-user-modified')) {
              const defaults = calculateSmartDefaults()
              s2MaterialCost.value = defaults.s2_materialCost
              // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
            }
          }
        })
      }
    
      if(otherMaterialText) {
        otherMaterialText.addEventListener('input', (e) => {
          state.otherMaterial = e.target.value
          if(state.otherMaterial) {
            state.material = 'å…¶ä»–æè´¨ï¼š' + state.otherMaterial
          }
          // å¦‚æœå·²æ˜¾ç¤ºè®¾å¤‡æ¨èé¡µé¢ï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°ä»·æ ¼
          const step2 = document.getElementById('step2')
          if(step2 && step2.style.display === 'block') {
            renderSeries()
          }
          
          // å¦‚æœå·²æ˜¾ç¤ºROIè¾“å…¥é¡µé¢ï¼Œæ›´æ–°å¹´ææ–™æˆæœ¬
          const roiInputSection = document.getElementById('roiInputSection')
          if(roiInputSection && roiInputSection.style.display !== 'none') {
            const s2MaterialCost = document.getElementById('s2_materialCost')
            if(s2MaterialCost && !s2MaterialCost.hasAttribute('data-user-modified')) {
              const defaults = calculateSmartDefaults()
              s2MaterialCost.value = defaults.s2_materialCost
              // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
            }
          }
        })
      }

      const thicknessMaxEl = document.getElementById('thicknessMax')
      if(thicknessMaxEl) {
        thicknessMaxEl.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || 3.0
          state.thicknessMax = val
          // å¦‚æœå·²æ˜¾ç¤ºè®¾å¤‡æ¨èé¡µé¢ï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°ä»·æ ¼
          const step2 = document.getElementById('step2')
          if(step2 && step2.style.display === 'block') {
            renderSeries()
          }
        })
      }

      const maxWidthEl = document.getElementById('maxWidth')
      if(maxWidthEl) {
        maxWidthEl.addEventListener('input', (e) => {
          state.maxWidth = parseInt(e.target.value) || 1500
          // å¦‚æœå·²æ˜¾ç¤ºè®¾å¤‡æ¨èé¡µé¢ï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°ä»·æ ¼
          const step2 = document.getElementById('step2')
          if(step2 && step2.style.display === 'block') {
            renderSeries()
          }
        })
      }

      const annualTonsEl = document.getElementById('annualTons')
      if(annualTonsEl) {
        annualTonsEl.addEventListener('input', (e) => {
          state.annualTons = parseFloat(e.target.value) || 10000
          // å¦‚æœå·²æ˜¾ç¤ºè®¾å¤‡æ¨èé¡µé¢ï¼Œé‡æ–°æ¸²æŸ“ä»¥æ›´æ–°ä»·æ ¼
          const step2 = document.getElementById('step2')
          if(step2 && step2.style.display === 'block') {
            renderSeries()
          }
          
          // å¦‚æœå·²æ˜¾ç¤ºROIè¾“å…¥é¡µé¢ï¼Œæ›´æ–°ç›¸å…³å­—æ®µ
          const roiInputSection = document.getElementById('roiInputSection')
          if(roiInputSection && roiInputSection.style.display !== 'none') {
            const selectedKey = state.selectedSeriesKey || state.recommendedKey
            const tons = state.annualTons
            
            // æ›´æ–°å¹´ææ–™æˆæœ¬ï¼ˆå¦‚æœç”¨æˆ·æœªæ‰‹åŠ¨ä¿®æ”¹ï¼‰
            const s2MaterialCost = document.getElementById('s2_materialCost')
            if(s2MaterialCost && !s2MaterialCost.hasAttribute('data-user-modified')) {
              const defaults = calculateSmartDefaults()
              s2MaterialCost.value = defaults.s2_materialCost
            }
            
            // æ›´æ–°èƒ½è€—èŠ‚çœï¼ˆå¦‚æœèƒ½è€—é¡¹æ˜¾ç¤ºä¸”ç”¨æˆ·æœªæ‰‹åŠ¨ä¿®æ”¹ï¼‰
            const s4Item = document.getElementById('savings-item-4')
            if(s4Item && s4Item.style.display !== 'none') {
              const s4EnergyCost = document.getElementById('s4_energyCost')
              if(s4EnergyCost && !s4EnergyCost.hasAttribute('data-user-modified')) {
                const defaults = calculateSmartDefaults()
                s4EnergyCost.value = defaults.s4_energyCost
              }
            }
            
            // æ›´æ–°é¢„è§ˆç»“æœ
            updatePreviewResults()
          }
        })
      }

      const painsGroup = document.getElementById('painsGroup')
      const otherPainInput = document.getElementById('otherPainInput')
      const otherPainText = document.getElementById('otherPainText')
      
      if(painsGroup) {
        const painCheckboxes = painsGroup.querySelectorAll('input[type="checkbox"]')
        painCheckboxes.forEach(checkbox => {
          checkbox.addEventListener('change', (e) => {
            const pain = e.target.value
            const isChecked = e.target.checked
            
            if(isChecked) {
              // æ£€æŸ¥æ˜¯å¦å·²é€‰5é¡¹ï¼ˆåŒ…æ‹¬"å…¶ä»–"ï¼‰
              if(state.pains.length >= 5) {
                e.target.checked = false
                alert('æœ€å¤šåªèƒ½é€‰æ‹©5é¡¹')
                return
              }
              // é€‰æ‹©
              if(!state.pains.includes(pain)) {
                state.pains.push(pain)
              }
              if(pain === 'å…¶ä»–' && otherPainInput) {
                otherPainInput.classList.add('show')
              }
            } else {
              // å–æ¶ˆé€‰æ‹©
              const idx = state.pains.indexOf(pain)
              if(idx >= 0) {
                state.pains.splice(idx, 1)
              }
              if(pain === 'å…¶ä»–') {
                if(otherPainInput) otherPainInput.classList.remove('show')
                state.otherPain = ''
                if(otherPainText) otherPainText.value = ''
              }
            }
          })
        })
      }

      if(otherPainText) {
        otherPainText.addEventListener('input', (e) => {
          state.otherPain = e.target.value
        })
      }

      const recommendBtn = document.getElementById('recommendBtn')
      if(recommendBtn) {
        recommendBtn.addEventListener('click', function(e) {
          e.preventDefault()
          e.stopPropagation()
          console.log('æ™ºèƒ½æ¨èæŒ‰é’®è¢«ç‚¹å‡»ï¼ˆä¸»ç»‘å®šï¼‰')
          
          try {
            // æ›´æ–°painsæ•°ç»„ï¼ŒåŒ…å«å…¶ä»–é€‰é¡¹çš„è‡ªå¡«å†…å®¹
            const finalPains = [...state.pains]
            if(state.otherPain) {
              finalPains.push('å…¶ä»–ï¼š' + state.otherPain)
            }
            state.pains = finalPains
            console.log('painsæ•°ç»„:', state.pains)
            
            console.log('è°ƒç”¨renderSerieså‰')
            if(typeof renderSeries === 'function') {
              renderSeries()
              console.log('renderSeriesè°ƒç”¨å®Œæˆ')
            } else {
              console.error('renderSeriesä¸æ˜¯å‡½æ•°')
            }
            
            console.log('è°ƒç”¨showStep2å‰')
            if(typeof showStep2 === 'function') {
              showStep2()
              console.log('showStep2è°ƒç”¨å®Œæˆ')
            } else {
              console.error('showStep2ä¸æ˜¯å‡½æ•°')
            }
            console.log('è°ƒç”¨showStep2å')
          } catch(err) {
            console.error('æ™ºèƒ½æ¨èæŒ‰é’®ç‚¹å‡»é”™è¯¯:', err)
            console.error('é”™è¯¯å †æ ˆ:', err.stack)
            alert('å‘ç”Ÿé”™è¯¯ï¼š' + err.message + '\nè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯')
          }
        })
        console.log('æ™ºèƒ½æ¨èæŒ‰é’®äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®šï¼ˆä¸»ç»‘å®šï¼‰')
      } else {
        console.error('æ™ºèƒ½æ¨èæŒ‰é’®æœªæ‰¾åˆ°')
      }

      const evaluateROIBtn = document.getElementById('evaluateROIBtn')
      if(evaluateROIBtn) {
        evaluateROIBtn.addEventListener('click', () => {
          showStep3()
        })
      }

      // æ‰€æœ‰è¾“å…¥æ¡†å˜åŒ–æ—¶ï¼ˆéšè—å­—æ®µä¸éœ€è¦ç›‘å¬ï¼Œåªç›‘å¬å¯è§å­—æ®µï¼‰
      // 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Šï¼ˆç›‘å¬åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡å’Œå•ä½äº§å“åˆ©æ¶¦ï¼‰
      const s1OldCapacity = document.getElementById('s1_oldCapacity')
      if(s1OldCapacity) {
        s1OldCapacity.addEventListener('input', (e) => {
          s1OldCapacity.setAttribute('data-user-modified', 'true')
          // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
        })
      }
      
      const s1ProfitPerTon = document.getElementById('s1_profitPerTon')
      if(s1ProfitPerTon) {
        s1ProfitPerTon.addEventListener('input', (e) => {
          s1ProfitPerTon.setAttribute('data-user-modified', 'true')
          // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
        })
      }
      
      // 2. ææ–™åˆ©ç”¨ç‡æå‡ï¼ˆåªç›‘å¬åŸåˆæ ¼ç‡å’Œå¹´ææ–™æˆæœ¬ï¼‰
      const s2OldRate = document.getElementById('s2_oldRate')
      if(s2OldRate) {
        s2OldRate.addEventListener('input', () => {
          // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
        })
      }
      
      const s2MaterialCost = document.getElementById('s2_materialCost')
      if(s2MaterialCost) {
        s2MaterialCost.addEventListener('input', (e) => {
          s2MaterialCost.setAttribute('data-user-modified', 'true')
          // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
        })
      }
      
      // 3. äººå·¥æˆæœ¬èŠ‚çº¦ï¼ˆåªç›‘å¬åŸæ“ä½œäººæ•°å’Œé¢„ä¼°äººå‡å¹´æˆæœ¬ï¼‰
      const s3OldWorkers = document.getElementById('s3_oldWorkers')
      if(s3OldWorkers) {
        s3OldWorkers.addEventListener('input', () => {
          // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
        })
      }
      
      const s3CostPerWorker = document.getElementById('s3_costPerWorker')
      if(s3CostPerWorker) {
        s3CostPerWorker.addEventListener('input', () => {
          // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
        })
      }
      
      // 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½ï¼ˆåªç›‘å¬å¹´ç”µè´¹ï¼ŒèŠ‚èƒ½æ¯”ä¾‹ç”±ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼‰
      const s4EnergyCost = document.getElementById('s4_energyCost')
      if(s4EnergyCost) {
        s4EnergyCost.addEventListener('input', (e) => {
          s4EnergyCost.setAttribute('data-user-modified', 'true')
          // å®æ—¶é¢„è§ˆç»“æœå·²åˆ é™¤
        })
      }

      // ä½¿ç”¨ç»Ÿä¸€çš„ç»‘å®šå‡½æ•°
      bindCalculateReportButton()

      // è¿”å›æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
      const backToStep1Btn = document.getElementById('backToStep1Btn')
      if(backToStep1Btn) {
        backToStep1Btn.addEventListener('click', (e) => {
          e.preventDefault()
          backToStep1()
        })
      }
      
      const backToStep2Btn = document.getElementById('backToStep2Btn')
      if(backToStep2Btn) {
        backToStep2Btn.addEventListener('click', (e) => {
          e.preventDefault()
          backToStep2()
        })
      }
      
      const backToROIInputBtn = document.getElementById('backToROIInputBtn')
      if(backToROIInputBtn) {
        backToROIInputBtn.addEventListener('click', (e) => {
          e.preventDefault()
          backToROIInput()
        })
      }

      // åº•éƒ¨å›ºå®šæŒ‰é’®åŠŸèƒ½
      const getSolutionBtn = document.getElementById('getSolutionBtn')
      if(getSolutionBtn) {
        getSolutionBtn.addEventListener('click', () => {
          // å¡«å……è¡Œä¸šä¿¡æ¯
          const leadIndustry = document.getElementById('leadIndustry')
          if(leadIndustry) leadIndustry.value = state.industry || 'é€šç”¨é’£é‡‘'
          // æ˜¾ç¤ºç•™èµ„è¡¨å•
          const leadForm = document.getElementById('leadForm')
          if(leadForm) {
            leadForm.style.display = 'block'
            leadForm.scrollIntoView({ behavior: 'smooth', block: 'start' })
          }
        })
      }

      // æ˜¾ç¤ºè”ç³»ä¿¡æ¯å¼¹çª—
      function showContactInfo() {
        const modal = document.getElementById('contactInfoModal')
        if(modal) {
          modal.style.display = 'block'
        }
      }
      
      // å…³é—­è”ç³»ä¿¡æ¯å¼¹çª—
      function closeContactInfo() {
        const modal = document.getElementById('contactInfoModal')
        if(modal) {
          modal.style.display = 'none'
        }
      }
      
      const freeTestBtn = document.getElementById('freeTestBtn')
      if(freeTestBtn) {
        freeTestBtn.addEventListener('click', (e) => {
          e.preventDefault()
          showContactInfo()
        })
      }
      
      // å…³é—­è”ç³»ä¿¡æ¯å¼¹çª—æŒ‰é’®
      const closeContactInfoBtn = document.getElementById('closeContactInfoBtn')
      if(closeContactInfoBtn) {
        closeContactInfoBtn.addEventListener('click', (e) => {
          e.preventDefault()
          closeContactInfo()
        })
      }
      
      const closeContactInfoBtn2 = document.getElementById('closeContactInfoBtn2')
      if(closeContactInfoBtn2) {
        closeContactInfoBtn2.addEventListener('click', (e) => {
          e.preventDefault()
          closeContactInfo()
        })
      }
      
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      const contactInfoModal = document.getElementById('contactInfoModal')
      if(contactInfoModal) {
        contactInfoModal.addEventListener('click', (e) => {
          if(e.target === contactInfoModal) {
            closeContactInfo()
          }
        })
      }

      const downloadReportBtn = document.getElementById('downloadReportBtn')
      if(downloadReportBtn) {
        downloadReportBtn.addEventListener('click', (e) => {
          e.preventDefault()
          // æ£€æŸ¥æ˜¯å¦å·²ç”ŸæˆæŠ¥å‘Š
          const step4 = document.getElementById('step4')
          if(step4 && step4.style.display === 'none') {
            alert('è¯·å…ˆå®ŒæˆROIæµ‹ç®—å¹¶æŸ¥çœ‹æŠ¥å‘Š')
            return
          }
          downloadPDFReport()
        })
      }

      // ç•™èµ„è¡¨å•åŠŸèƒ½
      // æŸ¥çœ‹è¾“å…¥æ•°æ®æŒ‰é’®
      const viewDataBtn = document.getElementById('viewDataBtn')
      if(viewDataBtn) {
        viewDataBtn.addEventListener('click', (e) => {
          e.preventDefault()
          showDataPreview()
        })
      }
      
      // å…³é—­æ•°æ®é¢„è§ˆæŒ‰é’®
      const closeDataPreviewBtn = document.getElementById('closeDataPreviewBtn')
      if(closeDataPreviewBtn) {
        closeDataPreviewBtn.addEventListener('click', (e) => {
          e.preventDefault()
          closeDataPreview()
        })
      }
      
      const closeDataPreviewBtn2 = document.getElementById('closeDataPreviewBtn2')
      if(closeDataPreviewBtn2) {
        closeDataPreviewBtn2.addEventListener('click', (e) => {
          e.preventDefault()
          closeDataPreview()
        })
      }
      
      // å¤åˆ¶æ•°æ®æŒ‰é’®
      const copyDataBtn = document.getElementById('copyDataBtn')
      if(copyDataBtn) {
        copyDataBtn.addEventListener('click', (e) => {
          e.preventDefault()
          copyDataToClipboard()
        })
      }
      
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      const dataPreviewModal = document.getElementById('dataPreviewModal')
      if(dataPreviewModal) {
        dataPreviewModal.addEventListener('click', (e) => {
          if(e.target === dataPreviewModal) {
            closeDataPreview()
          }
        })
      }
      
      const submitLeadBtn = document.getElementById('submitLeadBtn')
      if(submitLeadBtn) {
        submitLeadBtn.addEventListener('click', () => {
          const leadName = document.getElementById('leadName')
          const leadPhone = document.getElementById('leadPhone')
          const name = leadName ? leadName.value.trim() : ''
          const phone = leadPhone ? leadPhone.value.trim() : ''
          
          if(!name || !phone) {
            alert('è¯·å¡«å†™å§“åå’Œç”µè¯')
            return
          }
          
          // æ”¶é›†æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„æ•°æ®
          const allData = collectAllUserData()
          
          // è¿™é‡Œå¯ä»¥å¯¹æ¥åç«¯API
          const leadIndustry = document.getElementById('leadIndustry')
          const leadRemark = document.getElementById('leadRemark')
          const leadData = {
            name: name,
            phone: phone,
            industry: leadIndustry ? leadIndustry.value : '',
            remark: leadRemark ? leadRemark.value.trim() : '',
            // åŒ…å«å®Œæ•´çš„ç”¨æˆ·è¾“å…¥æ•°æ®
            fullData: allData
          }
          
          // è¾“å‡ºå®Œæ•´æ•°æ®åˆ°æ§åˆ¶å°ï¼ˆæ–¹ä¾¿å¼€å‘è€…æŸ¥çœ‹ï¼‰
          console.log('========== æäº¤ç•™èµ„ä¿¡æ¯ ==========')
          console.log('ç•™èµ„ä¿¡æ¯:', {
            name: leadData.name,
            phone: leadData.phone,
            industry: leadData.industry,
            remark: leadData.remark
          })
          console.log('å®Œæ•´è¾“å…¥æ•°æ®:', JSON.stringify(allData, null, 2))
          console.log('================================')
          
          // æ¨¡æ‹Ÿæäº¤ï¼ˆå¯ä»¥æ›¿æ¢ä¸ºçœŸå®çš„APIè°ƒç”¨ï¼‰
          // fetch('/api/lead', {
          //   method: 'POST',
          //   headers: { 'Content-Type': 'application/json' },
          //   body: JSON.stringify(leadData)
          // })
          
          alert('æäº¤æˆåŠŸï¼æˆ‘ä»¬çš„å·¥ç¨‹å¸ˆå°†åœ¨24å°æ—¶å†…ä¸æ‚¨è”ç³»ï¼Œä¸ºæ‚¨æä¾›ç²¾å‡†æ–¹æ¡ˆ')
          
          // éšè—è¡¨å•
          const leadForm = document.getElementById('leadForm')
          if(leadForm) leadForm.style.display = 'none'
          // æ¸…ç©ºè¡¨å•
          if(leadName) leadName.value = ''
          if(leadPhone) leadPhone.value = ''
          if(leadRemark) leadRemark.value = ''
        })
      }

      const cancelLeadBtn = document.getElementById('cancelLeadBtn')
      if(cancelLeadBtn) {
        cancelLeadBtn.addEventListener('click', () => {
          const leadForm = document.getElementById('leadForm')
          if(leadForm) leadForm.style.display = 'none'
        })
      }
    } // ç»“æŸinitEventListenerså‡½æ•°

    // åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
    function initApp() {
      console.log('å¼€å§‹åˆå§‹åŒ–åº”ç”¨...')
      console.log('document.readyState:', document.readyState)
      
      // æ£€æŸ¥å…³é”®å…ƒç´ æ˜¯å¦å­˜åœ¨
      const recommendBtn = document.getElementById('recommendBtn')
      console.log('æ™ºèƒ½æ¨èæŒ‰é’®:', recommendBtn)
      
      if(document.readyState === 'loading') {
        console.log('ç­‰å¾…DOMContentLoaded...')
        document.addEventListener('DOMContentLoaded', () => {
          console.log('DOMContentLoadedè§¦å‘')
          initEventListeners()
        })
      } else {
        console.log('DOMå·²åŠ è½½ï¼Œç«‹å³æ‰§è¡Œåˆå§‹åŒ–')
        // DOMå·²ç»åŠ è½½å®Œæˆï¼Œç›´æ¥æ‰§è¡Œ
        initEventListeners()
      }
    }
    
    // ç«‹å³å°è¯•åˆå§‹åŒ–
    initApp()
    
    // å¦‚æœä¸Šé¢çš„æ–¹æ³•å¤±è´¥ï¼Œä½¿ç”¨window.onloadä½œä¸ºå¤‡é€‰
    window.addEventListener('load', () => {
      console.log('window.onloadè§¦å‘')
      const recommendBtn = document.getElementById('recommendBtn')
      if(recommendBtn && !recommendBtn.onclick) {
        console.log('å¤‡é€‰æ–¹æ¡ˆï¼šé‡æ–°ç»‘å®šæ™ºèƒ½æ¨èæŒ‰é’®')
        recommendBtn.addEventListener('click', () => {
          console.log('æ™ºèƒ½æ¨èæŒ‰é’®è¢«ç‚¹å‡»ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰')
          const finalPains = [...state.pains]
          if(state.otherPain) {
            finalPains.push('å…¶ä»–ï¼š' + state.otherPain)
          }
          state.pains = finalPains
          renderSeries()
          showStep2()
        })
      }
      
      // å¤‡é€‰æ–¹æ¡ˆï¼šé‡æ–°ç»‘å®šè®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®
      console.log('å¤‡é€‰æ–¹æ¡ˆï¼šé‡æ–°ç»‘å®šè®¡ç®—å¹¶æŸ¥çœ‹æŠ¥å‘ŠæŒ‰é’®')
      bindCalculateReportButton()
      
      // å¤‡é€‰æ–¹æ¡ˆï¼šé‡æ–°ç»‘å®šè”ç³»ä¿¡æ¯å¼¹çª—æŒ‰é’®
      const freeTestBtn = document.getElementById('freeTestBtn')
      if(freeTestBtn) {
        freeTestBtn.onclick = (e) => {
          e.preventDefault()
          if(typeof showContactInfo === 'function') {
            showContactInfo()
          }
        }
      }
      
      const closeContactInfoBtn = document.getElementById('closeContactInfoBtn')
      if(closeContactInfoBtn) {
        closeContactInfoBtn.onclick = (e) => {
          e.preventDefault()
          if(typeof closeContactInfo === 'function') {
            closeContactInfo()
          }
        }
      }
      
      const closeContactInfoBtn2 = document.getElementById('closeContactInfoBtn2')
      if(closeContactInfoBtn2) {
        closeContactInfoBtn2.onclick = (e) => {
          e.preventDefault()
          if(typeof closeContactInfo === 'function') {
            closeContactInfo()
          }
        }
      }
      
      // å¤‡é€‰æ–¹æ¡ˆï¼šé‡æ–°ç»‘å®šè¿”å›æŒ‰é’®
      const backToStep1Btn = document.getElementById('backToStep1Btn')
      if(backToStep1Btn) {
        backToStep1Btn.onclick = (e) => {
          e.preventDefault()
          backToStep1()
        }
      }
      
      const backToStep2Btn = document.getElementById('backToStep2Btn')
      if(backToStep2Btn) {
        backToStep2Btn.onclick = (e) => {
          e.preventDefault()
          backToStep2()
        }
      }
      
      const backToROIInputBtn = document.getElementById('backToROIInputBtn')
      if(backToROIInputBtn) {
        backToROIInputBtn.onclick = (e) => {
          e.preventDefault()
          backToROIInput()
        }
      }
    })

    // PDFä¸‹è½½åŠŸèƒ½ï¼ˆä½¿ç”¨jsPDF + ä¸­æ–‡å­—ä½“æ”¯æŒï¼‰
    function downloadPDFReport() {
      // åŠ¨æ€åŠ è½½jsPDFå’Œhtml2canvasï¼ˆç”¨äºæ”¯æŒä¸­æ–‡ï¼‰
      if(typeof window.jsPDF === 'undefined') {
        const script1 = document.createElement('script')
        script1.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'
        script1.onload = () => {
          loadHtml2Canvas()
        }
        document.head.appendChild(script1)
      } else {
        loadHtml2Canvas()
      }
    }
    
    function loadHtml2Canvas() {
      if(typeof window.html2canvas === 'undefined') {
        const script2 = document.createElement('script')
        script2.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js'
        script2.onload = () => {
          generatePDF()
        }
        document.head.appendChild(script2)
      } else {
        generatePDF()
      }
    }

    function generatePDF() {
      try {
        // æ–¹æ³•1: å°è¯•ä½¿ç”¨html2canvas + jsPDFï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
        const reportSection = document.getElementById('step4')
        if(reportSection && typeof window.html2canvas !== 'undefined') {
          // ç¡®ä¿æŠ¥å‘ŠåŒºåŸŸå¯è§
          if(reportSection.style.display === 'none') {
            reportSection.style.display = 'block'
            reportSection.style.visibility = 'hidden'
            reportSection.style.position = 'absolute'
            reportSection.style.left = '-9999px'
          }
          
          html2canvas(reportSection, {
            scale: 2,
            useCORS: true,
            logging: false,
            backgroundColor: '#ffffff',
            windowWidth: reportSection.scrollWidth,
            windowHeight: reportSection.scrollHeight
          }).then(canvas => {
            const imgData = canvas.toDataURL('image/png')
            const { jsPDF } = window.jspdf
            const pdf = new jsPDF('p', 'mm', 'a4')
            const imgWidth = 210
            const pageHeight = 297
            const imgHeight = (canvas.height * imgWidth) / canvas.width
            let heightLeft = imgHeight
            let position = 0
            
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight)
            heightLeft -= pageHeight
            
            while (heightLeft >= 0) {
              position = heightLeft - imgHeight
              pdf.addPage()
              pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight)
              heightLeft -= pageHeight
            }
            
            pdf.save('ROIæµ‹ç®—æŠ¥å‘Š.pdf')
            
            // æ¢å¤æŠ¥å‘ŠåŒºåŸŸæ˜¾ç¤ºçŠ¶æ€
            if(reportSection.style.position === 'absolute') {
              reportSection.style.display = ''
              reportSection.style.visibility = ''
              reportSection.style.position = ''
              reportSection.style.left = ''
            }
          }).catch(err => {
            console.error('ç”ŸæˆPDFå¤±è´¥:', err)
            // æ¢å¤æŠ¥å‘ŠåŒºåŸŸæ˜¾ç¤ºçŠ¶æ€
            if(reportSection && reportSection.style.position === 'absolute') {
              reportSection.style.display = ''
              reportSection.style.visibility = ''
              reportSection.style.position = ''
              reportSection.style.left = ''
            }
            generatePDFText() // é™çº§åˆ°æ–‡æœ¬æ–¹æ³•
          })
          return
        }
        
        // æ–¹æ³•2: é™çº§åˆ°æ–‡æœ¬æ–¹æ³•ï¼ˆä½¿ç”¨Unicodeæ”¯æŒï¼‰
        generatePDFText()
      } catch(err) {
        console.error('PDFç”Ÿæˆé”™è¯¯:', err)
        alert('PDFç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¡®ä¿å·²å¡«å†™å®Œæ•´æ•°æ®')
      }
    }
    
    function generatePDFText() {
      const { jsPDF } = window.jspdf
      const doc = new jsPDF()
      
      // ä½¿ç”¨æ”¯æŒä¸­æ–‡çš„æ–¹æ³• - å°†ä¸­æ–‡è½¬æ¢ä¸ºå¯æ˜¾ç¤ºçš„æ ¼å¼
      // æ ‡é¢˜
      doc.setFontSize(20)
      doc.setTextColor(230, 0, 32)
      doc.text('ROIæµ‹ç®—æŠ¥å‘Š', 105, 20, { align: 'center' })
      
      // ç”Ÿäº§æƒ…å†µ
      doc.setFontSize(12)
      doc.setTextColor(0, 0, 0)
      let y = 35
      doc.text(`æ‰€å±è¡Œä¸šï¼š${state.industry || 'é€šç”¨é’£é‡‘'}`, 20, y)
      y += 7
      doc.text(`ä¸»è¦ææ–™ï¼š${state.material || 'å†·è½§é’¢'}`, 20, y)
      y += 7
      doc.text(`æœ€å¤§åšåº¦ï¼š${state.thicknessMax || 3.0}mm`, 20, y)
      y += 7
      doc.text(`æœ€å¤§æ¿å®½ï¼š${state.maxWidth || 1500}mm`, 20, y)
      y += 7
      doc.text(`å¹´åŠ å·¥é‡ï¼š${state.annualTons || 10000}å¨`, 20, y)
      
      // è®¾å¤‡ä¿¡æ¯
      y += 15
      doc.setFontSize(14)
      doc.text('æ‰€é€‰è®¾å¤‡', 20, y)
      y += 8
      doc.setFontSize(12)
      const selectedKey = state.selectedSeriesKey || state.recommendedKey
      const recSeries = seriesList.find(s => s.key === selectedKey) || seriesList[2]
      const dynamicPrice = calculatePrice(selectedKey)
      doc.text(recSeries.name, 20, y)
      y += 7
      doc.text(`è®¾å¤‡å‚è€ƒä»·ï¼š${money(dynamicPrice)}`, 20, y)
      
      // æŠ•å…¥æ˜ç»†
      y += 15
      doc.setFontSize(14)
      doc.text('æ€»æŠ•å…¥ï¼ˆTCOï¼‰', 20, y)
      y += 8
      doc.setFontSize(12)
      const investmentDevice = dynamicPrice
      const investmentInstall = Math.round(dynamicPrice * 0.05)
      const investmentAux = Math.round(dynamicPrice * 0.03)
      const investmentTraining = Math.round(dynamicPrice * 0.02)
      const investmentMaintenance = Math.round(dynamicPrice * 0.04)
      const totalInvestment = investmentDevice + investmentInstall + investmentAux + investmentTraining + investmentMaintenance
      doc.text(`è®¾å¤‡æœ¬ä½“ä»·æ ¼ï¼š${money(investmentDevice)}`, 20, y)
      y += 7
      doc.text(`è¿è¾“ã€å®‰è£…ã€è°ƒè¯•ï¼š${money(investmentInstall)}`, 20, y)
      y += 7
      doc.text(`è¾…åŠ©é…å¥—æŠ•å…¥ï¼š${money(investmentAux)}`, 20, y)
      y += 7
      doc.text(`åŸ¹è®­ä¸äººåŠ›æˆæœ¬ï¼š${money(investmentTraining)}`, 20, y)
      y += 7
      doc.text(`é¦–å¹´ç»´æŠ¤ä¸å¤‡ä»¶ï¼š${money(investmentMaintenance)}`, 20, y)
      y += 7
      doc.setFontSize(13)
      doc.setFont(undefined, 'bold')
      doc.text(`æ€»æŠ•å…¥ï¼š${money(totalInvestment)}`, 20, y)
      doc.setFont(undefined, 'normal')
      
      // æ”¶ç›Šæ•°æ®
      y += 15
      doc.setFontSize(14)
      doc.text('æ”¶ç›Šä¼°ç®—', 20, y)
      y += 8
      doc.setFontSize(12)
      
      // 1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Š
      const s1_oldCapacityMonthly = parseFloat(document.getElementById('s1_oldCapacity').value || 0)
      const s1_newCapacity = parseFloat(document.getElementById('s1_newCapacity').value || 0)
      const s1_workHours = parseInt(document.getElementById('s1_workHours').value || 2200)
      const s1_profitPerTon = parseFloat(document.getElementById('s1_profitPerTon').value || 0)
      // å°†åŸè®¾å¤‡æ¯æœˆåŠ å·¥é‡è½¬æ¢ä¸ºæ¯å°æ—¶å¤„ç†é‡ï¼ˆæ¯æœˆ22ä¸ªå·¥ä½œæ—¥ï¼Œæ¯å¤©8å°æ—¶ = 176å°æ—¶ï¼‰
      const s1_oldCapacityHourly = s1_oldCapacityMonthly / 176
      const s1 = Math.round(s1_workHours * (s1_newCapacity - s1_oldCapacityHourly) * s1_profitPerTon)
      doc.text(`1. æ•ˆç‡æå‡å¸¦æ¥çš„äº§èƒ½æ”¶ç›Šï¼š${money(s1)}`, 20, y)
      y += 7
      
      // 2. ææ–™åˆ©ç”¨ç‡æå‡
      const s2_oldRate = parseFloat(document.getElementById('s2_oldRate').value || 0)
      const s2_newRate = parseFloat(document.getElementById('s2_newRate').value || 0)
      const s2_materialCost = parseInt(document.getElementById('s2_materialCost').value || 0)
      const s2 = Math.round(s2_materialCost * (s2_newRate - s2_oldRate) / 100)
      doc.text(`2. ææ–™åˆ©ç”¨ç‡æå‡ï¼š${money(s2)}`, 20, y)
      y += 7
      
      // 3. äººå·¥æˆæœ¬èŠ‚çº¦
      const s3_oldWorkers = parseInt(document.getElementById('s3_oldWorkers').value || 0)
      const s3_newWorkers = parseInt(document.getElementById('s3_newWorkers').value || 1)
      const s3_costPerWorker = parseInt(document.getElementById('s3_costPerWorker').value || 0)
      const s3 = Math.max(0, (s3_oldWorkers - s3_newWorkers) * s3_costPerWorker)
      doc.text(`3. äººå·¥æˆæœ¬èŠ‚çº¦ï¼š${money(s3)}`, 20, y)
      y += 7
      
      // 4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½ï¼ˆæ‰€æœ‰ç³»åˆ—éƒ½è®¡ç®—ï¼‰
      const s4_energyCost = parseInt(document.getElementById('s4_energyCost').value || 0)
      const s4_energySaveRate = parseFloat(document.getElementById('s4_energySaveRate').value || 0)
      const s4 = Math.round(s4_energyCost * s4_energySaveRate / 100)
      doc.text(`4. èƒ½è€—æˆ–è¿ç»´æˆæœ¬é™ä½ï¼š${money(s4)}`, 20, y)
      y += 7
      
      // æ ¸å¿ƒæŒ‡æ ‡
      y += 10
      doc.setFontSize(14)
      doc.text('æ ¸å¿ƒæŒ‡æ ‡', 20, y)
      y += 8
      doc.setFontSize(12)
      
      const total = document.getElementById('reportTotalSaving').textContent
      const payback = document.getElementById('reportPayback').textContent
      const roi = document.getElementById('reportROI').textContent
      
      doc.text(`å¹´å‡€æ”¶ç›Šï¼š${total}`, 20, y)
      y += 7
      doc.text(`æŠ•èµ„å›æŠ¥å‘¨æœŸï¼š${payback}`, 20, y)
      y += 7
      doc.text(`å¹´åŒ–ROIï¼š${roi}`, 20, y)
      y += 10
      doc.setFontSize(11)
      doc.setTextColor(100, 100, 100)
      doc.text('æ³¨ï¼šçŸ«å¹³æœºå¯¿å‘½é€šå¸¸10å¹´ä»¥ä¸Šï¼Œå³ä½¿å›æ”¶æœŸ2-3å¹´ï¼Œåç»­å‡ä¸ºçº¯æ”¶ç›Šã€‚', 20, y, { maxWidth: 170 })
      
      // ä¿å­˜PDF
      doc.save('ROIæµ‹ç®—æŠ¥å‘Š.pdf')
    }
    
    // æœ€åçš„å¤‡é€‰æ–¹æ¡ˆï¼šç¡®ä¿æ™ºèƒ½æ¨èæŒ‰é’®èƒ½å·¥ä½œ
    setTimeout(() => {
      console.log('å»¶è¿Ÿæ£€æŸ¥ï¼šæŸ¥æ‰¾æ™ºèƒ½æ¨èæŒ‰é’®')
      const recommendBtn = document.getElementById('recommendBtn')
      console.log('å»¶è¿Ÿæ£€æŸ¥ç»“æœ - æŒ‰é’®:', recommendBtn)
      
      if(recommendBtn) {
        // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
        const newBtn = recommendBtn.cloneNode(true)
        recommendBtn.parentNode.replaceChild(newBtn, recommendBtn)
        
        // é‡æ–°ç»‘å®šäº‹ä»¶
        newBtn.addEventListener('click', function(e) {
          e.preventDefault()
          e.stopPropagation()
          console.log('æ™ºèƒ½æ¨èæŒ‰é’®è¢«ç‚¹å‡»ï¼ˆå»¶è¿Ÿç»‘å®šï¼‰')
          
          try {
            // æ›´æ–°painsæ•°ç»„
            const finalPains = [...state.pains]
            if(state.otherPain) {
              finalPains.push('å…¶ä»–ï¼š' + state.otherPain)
            }
            state.pains = finalPains
            console.log('painsæ•°ç»„:', state.pains)
            
            console.log('è°ƒç”¨renderSerieså‰')
            if(typeof renderSeries === 'function') {
              renderSeries()
              console.log('renderSeriesè°ƒç”¨å®Œæˆ')
            } else {
              console.error('renderSeriesä¸æ˜¯å‡½æ•°')
            }
            
            console.log('è°ƒç”¨showStep2å‰')
            if(typeof showStep2 === 'function') {
              showStep2()
              console.log('showStep2è°ƒç”¨å®Œæˆ')
            } else {
              console.error('showStep2ä¸æ˜¯å‡½æ•°')
            }
            console.log('è°ƒç”¨showStep2å')
          } catch(err) {
            console.error('æ™ºèƒ½æ¨èæŒ‰é’®ç‚¹å‡»é”™è¯¯:', err)
            console.error('é”™è¯¯å †æ ˆ:', err.stack)
            alert('å‘ç”Ÿé”™è¯¯ï¼š' + err.message + '\nè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯')
          }
        })
        
        console.log('å»¶è¿Ÿç»‘å®šæˆåŠŸ')
      } else {
        console.error('å»¶è¿Ÿæ£€æŸ¥ï¼šæ™ºèƒ½æ¨èæŒ‰é’®æœªæ‰¾åˆ°')
      }
    }, 1000)
  </script>
</body>
</html>

